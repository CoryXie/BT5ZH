
本文档描述了执行基带协议和其他低级链路例程的蓝牙链路控制器的规范。

# 1 一般说明

本部分规定了蓝牙基带的正常工作。

蓝牙系统提供点对点连接或点对多点连接，见图1.1（a）和（b）。在点对点连接中，物理通道在两个蓝牙设备之间共享。在点对多点连接中，物理信道在多个蓝牙设备之间共享。共享相同物理信道的两个或多个设备形成微微网。一个蓝牙设备充当微微网的主机，而另一个设备作为从设备。微微网中最多可以有七个从设备。通道访问由主机控制。无限数量的从设备可以在携带CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路的物理信道上接收数据。

具有共同设备的微微网称为分散网络，请参见图中1.1（c）。每个微微网仅具有单个主机，然而，从机可以以时分复用为基础参与不同的微微网。另外，一个微微网中的主机可以是其他微微网中的从设备。微微网不得频率同步，每个微微网具有自己的跳频序列。


图1.1：具有单个从设备操作（a），多从操作（b）和分散网络操作（c）的微微网

数据通过空中数据包传输。定义了两种模式：称为基本速率的强制模式，称为增强数据速率的可选模式。所有调制模式的符号速率为1 Msym/s。基本速率的总空中数据速率为1Mb/s。增强数据速率具有提供2Mb/s的总空中数据速率的一次调制模式，以及提供3Mb/s的总空中数据速率的二次调制模式。

一般的基本速率数据包格式如图1.2所示。每个分组由3个实体组成：接入码，报头和有效载荷。

图1.2：标准基本速率包格式

一般的增强型数据速率数据包格式如图1.3所示。每个分组由6个实体组成：接入码，报头，保护周期，同步序列，增强数据速率有效载荷和报尾。

接入码和报头使用与基本速率分组相同的调制模式，而同步序列，增强型数据速率有效载荷和报尾使用增强型数据速率调制模式。保护周期允许调制模式之间的转换。

图1.3：标准增强数据速率数据包格式

## 1.1 蓝牙时钟

每个蓝牙设备都应有一个本机时钟，它将从一个自由运行的参考时钟导出。可以将偏移量添加到参考时钟，以将本机时钟与其他非蓝牙系统同步。为了与其他蓝牙设备同步，使用偏移量，当添加到本机时钟时，提供相互同步的临时蓝牙时钟。应该注意的是，蓝牙时钟与时间无关，因此可以将其初始化为任何值。时钟周期大约一天。如果使用计数器实现时钟，则需要一个28位计数器，该计数器将以2^28-1进行回绕。最低有效位（LSB）将以312.5 μs为单位跳动（即半个时隙），产生3.2 kHz的时钟速率。

时钟确定关键周期并触发设备中的事件。蓝牙系统中的四个周期是重要的：312.5 μs，625 μs，1.25 ms和1.28 s;这些周期分别对应于定时器位CLK0，CLK1，CLK2和CLK12，见图1.4。

图1.4：蓝牙时钟

在设备可以驻留的不同模式和状态下，时钟有不同的外观：

- CLKR参考时钟
- CLKN本机时钟
- CLKE估计时钟
- CLK主时钟

CLKR是由自由运行的系统时钟驱动的参考时钟。CLKN可以与参考时钟偏移定时偏移。在STANDBY和保持，嗅觉和无连接从播广播模式下，参考时钟的最差情况精度为+/- 250ppm。在所有其他情况下，其最坏情况精度为+/- 20ppm;在执行微微网时钟调整的同时，微微网主设备也将使用此精度（参见第8.6.10节）。

关于CLK的定义见第2.2.4节，CLK的定义见2.4.1节。

在微微网存在某一限度内，主人可以调整其本机时钟（见第8.6.10.3节）。主机还可以通过使用LMP_clk_adj序列来对本地时钟进行粗调。

## 1.2蓝牙设备寻址

每个蓝牙设备应分配唯一的48位蓝牙设备地址（BD_ADDR）。地址应为根据IEEE 802-2014标准（http://standards.ieee.org/findstds/standard/）第8.2节（“通用地址”）创建的48位扩展唯一标识符（EUI-48） 802- 2014.html）。

创建有效的EUI-48需要从IEEE注册机构获得以下MAC地址块类型之一：

- MAC地址块大（MA-L）
- MAC地址块介质（MA-M）
- MAC地址块小（MA-S）

有关获取其中一个MAC地址块的信息，请参阅http://standards.ieee.org/develop/regauth/index.html。有关创建EUI-48地址的教程，另请参见“48位全局标识符指南（EUI-48）”（https://standards.ieee.org/develop/regauth/tut/ eui48.pdf）。

图1.5说明了LAP，UAP和NAP如何映射到EUI-48。图1.5中的位模式是BD_ADDR的示例。

图1.5：BD_ADDR的格式

BD_ADDR可以采用任何值，除了对于一般和专用查询将具有64个保留的LAP值中的任何值（见第1.2.1节）。

### 1.2.1保留地址

64个连续LAP的块被保留用于查询操作;所有设备通用的一个LAP被保留用于一般查询，剩下的63个LAP被保留用于特定类别的设备的专用查询（参见分配的号码）。无论UAP和NAP的内容如何，​​都使用相同的LAP值。因此，这些LAP都不能成为用户BD_ADDR的一部分。
保留的LAP地址为0x9E8B00-0x9E8B3F。一般查询LAP为0x9E8B33。所有地址的LSB位于最右边的位置，即十六进制符号。当使用一个保留的LAP地址时，默认检查初始化（DCI）用作UAP。DCI被定义为0x00（十六进制）。

## 1.3接入码

在蓝牙系统中，物理通道上的所有传输都以访问码开始。定义了三种不同的接入码，另见第6.3.1节：

- 设备访问码（DAC）
- 通道访问码（CAC）
- 查询接入码（IAC）

所有接入码来自设备地址的LAP或查询地址。设备接入码用于页面，页面扫描和页面响应子状态，并应从分页设备的BD_ADDR派生。通道接入码用于CONNECTION状态，同步训练子状态和同步扫描子状态，并形成在微微网物理信道上交换的所有数据包的开始。通道接入码应从主机的BD_ADDR的LAP导出。最后，查询子代应使用查询访问码。有一般的IAC（GIAC）用于一般查询操作，并且有63个专用IAC（DIAC）用于专用查询操作。

接入码还向接收机指示包的到达。它用于定时同步和偏移补偿。接收机与接入码中的整个同步字相关，提供非常强大的信令。

# 2 物理通道

蓝牙系统中最低的架构层是物理通道。定义了多种类型的物理通道。所有蓝牙物理信道的特征在于基本伪随机跳频序列（其对于适配的微微网物理信道上的物理链路，然后被AFH_channel_map（在[第2卷，C部分，第5.2节中定义]对于该链路），传输的特定时隙定时，接入码和分组报头编码。这些方面与发射机的范围一起定义了物理信道的签名。对于基本和适应的微微网物理信道，跳频用于周期性地改变频率，以减少干扰的影响并满足当地法规要求。

希望通信的两个设备使用共享物理通道进行通信。为了实现这一点，它们的收发器必须同时被调谐到相同的RF频率，并且它们必须在彼此的标称范围内。

鉴于RF载波的数量有限，并且许多蓝牙设备可以在相同的空间和时间区域内独立地操作，因此两个独立的蓝牙设备将其收发器调谐到相同RF载波的强烈可能性，导致物理信道碰撞。为了减轻这种冲突的不必要的影响，物理信道上的每个传输都以访问码开始，该访问码被调谐到物理信道的设备用作相关代码。该通道接入码是物理通道的属性。接入码始终存在于每个传输的数据包的开始处。

定义了几个蓝牙物理通道。每个都被优化并用于不同的目的。这些物理通道中的两个（基本微微网通道和适配的微微网通道）用于连接的设备之间的通信，并与特定的微微网相关联。其他物理通道用于发现（查询扫描通道）和连接（页面扫描通道）蓝牙设备。设备使用同步扫描物理通道来获取有关CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路的定时和频率信息，或恢复当前微微网时钟。

蓝牙设备只能在任何给定时间使用这些物理通道之一。为了支持多个并发操作，设备在通道之间使用时分复用。以这种方式，蓝牙设备可以看起来在几个微微网中同时操作，以及可发现和可连接。

每当蓝牙设备与物理通道的定时，频率和接入码同步时，它被称为“连接”到该通道（无论其是否积极参与通道上的通信）。至少，设备只需要能够一次连接到一个物理信道，然而，高级设备可能能够同时连接到多个物理信道，但是规范并不认为这是可能的。

## 2.1物理通道定义

除了同步扫描物理信道（其使用一组固定RF信道）之外，物理信道由基本伪随机RF信道跳频序列，分组（时隙）定时和接入码定义。
跳频序列由蓝牙设备地址的UAP和LAP，所选择的基本跳频序列以及适用于微微网物理信道的物理链路上使用的AFH_channel_map来确定。跳频序列中的相位由蓝牙时钟决定。所有物理通道被细分为长度根据物理通道而不同的时隙。在物理信道中，每个接收或传输事件与时隙或时隙相关联。对于每个接收或传输事件，跳频选择内核选择一个RF频道（见第2.6节）。在CONNECTION状态下，最大跳跃速率为1600跳/秒，同步训练子状态和同步扫描子状态，查询和页面子状态中的最大跳跃速率为3200跳/秒。

定义了以下物理通道：

- 基本的微微网物理通道
- 适应微微网物理通道
- 页面扫描物理通道
- 查询扫描物理通道
- 同步扫描物理通道

## 2.2基本人物通道

在CONNECTION状态下，默认使用基本的微微网物理通道。也可以使用适配的微微网物理信道。适应的微微网物理信道与基本微微网物理信道相同，但第2.3节中列出的差异除外。

### 2.2.1主从定义

基本的微微网物理通道由微微网的主机定义。主机通过轮询方案控制微微网物理通道上的流量（见第8.5节）。

根据定义，通过分页发起连接的设备是主设备。一旦建立了微微网，可以更换主从角色。这在第8.6.5节中有描述。

### 2.2.2跳跃特性

基本的微微网物理信道的特征在于通过所有79个RF信道的伪随机跳频。微微网物理通道中的跳频由主机的蓝牙时钟和BD_ADDR决定。当微微网建立时，主时钟传送到从设备。每个从设备将为其本机时钟添加偏移量，以与主时钟同步。由于时钟是独立的，必须定期更新偏移量。参与微微网的所有设备都与时钟同步并与频道同步。

基本的微微网物理信道使用基本的信道跳频序列，并在第2.6节中描述。

### 2.2.3时间插槽

基本的微微网物理通道分为时隙，每个625？长度。时隙根据微微网主机的蓝牙时钟CLK28-1的最高有效位27进行编号。槽编号范围为0到227-1，循环长度为227。时隙号表示为k。

主从交替发送的TDD方案见图2.1。数据包起始应与插槽开始对齐。数据包可能会延伸多达五个时隙。

图2.1：多时隙数据包

术语时隙对用于指示从主从传输时隙开始的两个相邻时隙。

### 2.2.4微微网时钟

CLK是微微网的主时钟。它将用于微微网中的所有定时和调度活动。所有设备都应使用CLK调度其发送和接收。CLK应通过添加一个time_base_offset和slave_offset从参考时钟CLKR（见第1.1节）导出，参见图2.2。time_base_offset是一个值，设备可能会使用本地生成的偏移到CLKN，这是由于与外部时基的对齐引起的。因为CLK与其自己的本机时钟CLKN相同，因此slave_offset对于主器件为零。每个从机将向其CLKN添加适当的slave_offset，使得CLK对应于主机的CLKN。尽管设备中的所有CLKN都以相同的标称速率运行，但是相互漂移会导致CLK中的不准确。因此，必须定期更新从设备中的偏移量，使得CLK大约是主站的CLKN。

图2.2：主（a）和从（b）中CLK的推导

time_base_offset中的更改仅由微微网的主人进行;一个仅作为从设备的设备在正常操作中不需要区分CLKR和CLKN。在分散网络情况下，控制器可以改变time_base_offset以使其CLKN与外部时钟对齐，或者并置或者在从机的请求下，以及slave_offset来保持与不同微微网时钟的同步。在某些情况下，不可能确定由外部帧定时对齐（time_base_offset）引起的多少观察到的偏移量，以及由主器件和从器件之间的偏移造成多少（slave_offset）。

### 2.2.5发送/接收时序

主机传输始终始于偶数时隙（CLK1 = 0），从机传输始终以奇数时隙（CLK1 = 1）开始。由于覆盖多于单个时隙的分组类型，主传输可以在奇数编号的时隙中继续，从设备传输可以在偶数编号的时隙中继续，参见图2.1。

本章所示的所有时序图都是基于天线处的信号。用于描述定时的术语“精确”是指理想的传输或接收，忽略定时抖动和时钟频率缺陷。

分组传输的平均时间不得比移动速度快
相对于理想槽时间为20ppm的时间为625？秒。瞬时时间不得偏离1以上s从平均时间。所以绝对的
时隙边界k的分组传输定时tk应满足以下等式：

（EQ 1）

其中TN是标称槽长度（625 us），jk表示时隙k开始时的抖动（jk 1 s），dk表示时隙k内的漂移（dk 20 ppm）。抖动和漂移可以在每个时隙的给定限制内任意变化，而偏移量是任意但固定的常数。要保持并嗅探Link Manager Protocol [Vol 2] C部分4.3.1节中规定的漂移和抖动参数。

#### 2.2.5.1微微网物理通道时序

在附图中，仅示出了单时隙分组。

主TX/RX时序如图2.3所示。在图2.3和图2.4中，信道跳频频率由f（k）表示，其中k是时隙号。传输后，返回数据包是N？625？在TX分组开始之后，其中N是大于0的奇数，整数。N取决于传输的数据包的类型。

为了允许一段时间的滑倒，在确切的接收时间周围定义不确定性窗口。正常运行时窗口长度应为20
？s，这允许RX包达到10？太早还是10？太晚了建议从设备实现可变大小的窗口或时间
跟踪以适应主人超过250毫秒的缺席。

在RX周期开始时，访问相关器将通过不确定性窗口搜索正确的信道访问码。如果不发生事件触发，则接收机可能会进入睡眠状态直到下一个RX事件。如果在搜索过程中很明显，相关性输出将不会超过最终阈值，接收者可以早点睡觉。如果发生触发事件，则接收器应保持打开状态，以接收数据包的其余部分，除非数据包用于另一个设备，检测到不可恢复的报头错误或检测到不可恢复的有效负载错误。

图2.3：单时隙数据包在正常模式下主收发器的RX/TX周期

每个主传输应从主机的本机蓝牙时钟的位2导出，因此当前传输将被调度为Mx1250？在先前的主TX突发的开始之后，其中M取决于发送和接收的分组类型，并且是大于0的均匀整数。主发送定时应从主机的本机蓝牙时钟导出，因此不受从机时间漂移的影响。
从设备通过向从设备本机时钟添加时序偏移来维持主天线时钟的估计（见第2.2.4节）。每次从主机接收到数据包时，都应更新该偏移量。通过将接收到的分组的准确RX定时与估计的RX定时进行比较，从机将对任何定时未对准的偏移进行校正。由于仅需要通道访问码来同步从机，所以可以在主从传输槽中发送的任何数据包来校正从RX定时。

从机的TX/RX时序如图2.4所示。奴隶的传送将被安排N？625？在从机的RX分组开始之后，其中N是大于0的奇数正整数。如果从设备的RX定时漂移，其发射定时也将发生。在从设备处于活动模式（见第8.6节）期间，由于本地RF干扰，由于本地RF干扰而导致从设备活动，或者任何其他原因，从设备可能会增加从设备接收不确定性窗口和/或使用预测定时漂移，以增加在接收恢复时接收主机突发的概率。

图2.4：单时隙数据包的从设备收发器在正常模式下的RX/TX周期

#### 2.2.5.2微微网物理通道重新同步

在微微网物理通道中，如果至少每隔200ms（如果使用低功率时钟），从机可以不从主机接收到数据包，则从机可能会失去同步。由于主设备正在忙于其他任务，例如由于主机被牵涉到由于SCO，eSCO或CSB（Connectionless Slave Broadcast，无连接从设备广播）活动而导致其他设备在Sniff或Hold模式下的连接，主设备可能无法发送到从设备在互联网上，或由于干扰。当重新同步到微微网物理通道时，从设备在发送信息之前应监听主机（除了要监听主机但不发送信息的无连接从广播从设备之外）。在这种情况下，如图2.5所示，从设备中的同步搜索窗口的长度可以从20μs增加到更大的值Xμs。请注意，仅使用RX跳频。即使扩展到通常用于从主到主（TX）时隙的前一时间间隔，也将在不确定窗口中使用主从从（RX）时隙中使用的跳频。

如果搜索窗口X的长度超过1250μs，则连续的窗口应避免重叠的搜索窗口。连续的窗口应该以f（k），f（k + 4），... f（k + 4i）为中心（其中'i'是一个整数），给出最大值X = 2500μs，甚至在f（k），f（k + 6），... f（k + 6i），给出最大值X =3750μs。所使用的RX跳频应对应于主从传输时隙。

建议在从设备重新同步期间主站传输单时隙数据包。


图2.5：从保持模式返回从设备的RX定时

##适应皮肤物理通道

对于进入CSB（Connectionless Slave Broadcast，无连接从设备广播）模式的设备，传输CSB（Connectionless Slave Broadcast，无连接从设备广播）数据包的设备是微微网的主机，接收CSB（Connectionless Slave Broadcast，无连接从设备广播）数据包的任何设备都是微微网的从设备设备。

### 2.3.1跳跃特性

适应微微网物理信道上的每个物理链路应至少使用Nmin个RF信道（其中Nmin为20）。

适应的微微网物理信道使用第2.6节中描述的适配信道跳频序列。

适应的微微网物理通道可用于已启用自适应跳频（AFH）的连接设备。基本和适应的微微网物理通道之间有两个区别。第一个是使从设备频率与前一个主站传输相同的通道机制。第二方面是适配的微微网物理信道可以基于小于基本微微网物理信道的全部79个频率。适应微微网物理信道上的每个物理链路可以使用不同的频率集合。

## 2.4页面扫描物理通道

虽然在连接之前没有定义主从角色，但是术语主机用于寻呼设备（在CONNECTION状态下成为主机），从机用于页面扫描设备（在CONNECTION状态中成为从机） ）。

### 2.4.1寻呼的时钟估计

寻呼设备使用页面扫描设备CLKE的本机时钟的估计;即将偏移量添加到寻呼机的CLKN以近似收信人的CLKN，见图2.6。CLKE应通过添加偏移从本机CLKN导出。通过使用收件人的CLKN，寻呼机可能能够加快连接建立。注意：CLKR从不用于导出CLKE或跳频内核的任何其他控制。


图2.6：派生CLKE

### 2.4.2跳跃特性

页面扫描物理信道遵循比基本微微网物理信道更慢的跳频模式，并且是通过RF信道的短的伪随机跳频序列。页面扫描通道的时序应由扫描设备的本机蓝牙时钟确定。跳频序列由扫描设备的蓝牙地址决定。

页面扫描物理通道使用第2.6节中指定的页面，主页面响应，从设备页面响应和页面扫描跳转序列。

### 2.4.3寻呼程序时序

在寻呼过程中，主机应发送与要连接的从设备对应的寻呼消息（见表8.3）。由于寻呼消息是非常短的报文，因此跳数为3200跳/秒。在单个TX时隙中，寻呼设备应在两个不同的跳频上进行发送。在图2.7至图2.11中，f（k）用于页面跳频序列的频率，f'（k）表示相应的页面响应等速频率。第一个传输开始，其中CLK0 = 0，第二个传输开始，其中CLK0 = 1。

在单个RX时隙间隔中，寻呼设备应在两个不同的跳频上监听从设备页响应消息。类似于传输，标称接收开始于CLK0 = 0，第二个接收名义上开始，其中CLK0 = 1;见图2.7。在TX时隙期间，寻呼设备应以TX跳频f（k）和f（k + 1）发送寻呼消息。在RX时隙中，它将监听对应的RX跳频f'（k）和f'（k + 1）的响应。收听期间应在相应的寻呼包之后的625个时刻精确定时，并包括一个？10？不确定窗口。


图2.7：PAGE模式下收发器的RX/TX周期

### 2.4.4页面响应时间

在连接建立时，主页响应数据包从主站发送到从设备（见表8.3）。该分组建立定时和频率同步。从设备接收到页面消息后，应返回一个包含从设备页响应报文的响应报文，并按照625s收到页面消息后。主机应根据主机的RX/TX定时，在接收到从响应的RX时隙之后的TX时隙中发送主页响应报文。从页面响应和主页响应消息之间的时间差将取决于从设备接收到的页面消息的时序。在图2.8中，从设备接收在主站到从设备槽中首先发送的寻呼消息。然后，它在从主机到主机时隙的前半部分中以第一个从机响应分组进行响应。主页响应数据包的定时是基于先前主从从设备槽位首先发送的页面消息的时序：有一个确切的1250
？第一页消息和主页响应包之间的延迟。以跳频f（k + 1）发送分组，该频率是接收到寻呼消息的跳频f（k）之后的跳频。


图2.8：上半部分成功页面上页面响应数据包的时序

在图2.9中，从设备接收主站到从设备槽中发送的寻呼消息。然后它在从设备 - 主机时隙的后半部分中正好具有625的从页面响应数据包进行响应？s收到页面消息后。主页响应分组的定时仍然是基于先前主从从机槽中首先发送的寻呼消息的时序：有一个确切的1250？第一页消息和主页响应包之间的延迟。该分组以跳频f（k + 2）发送，跳频是跟在接收到该寻呼消息的跳频f（k + 1）之后的跳频。


图2.9：后半段成功页面页面响应数据包的时序

从机应根据主页响应数据包的接收（而不是根据页面消息的接收）调整其RX/TX时序。也就是说，应当发送确认主页响应包的接收的第二从页响应消息625？s在主页响应包开始之后。

查询扫描物理通道

虽然在连接之前没有定义主从角色，但是主机用于查询设备，从设备用于查询扫描设备。

### 2.5.1查询时钟

用于查询和查询扫描的时钟应为设备的本机时钟。

### 2.5.2跳跃特性

查询扫描信道遵循比微微网物理信道更慢的跳频模式，并且是通过RF信道的短的伪随机跳频序列。查询扫描通道的定时由扫描设备的本机蓝牙时钟确定，而跳频序列由通用查询访问码确定。

查询扫描物理信道使用第2.6节中描述的查询，查询响应和查询扫描跳频序列。

### 2.5.3查询程序时间

在查询过程中，主人应使用通用或专用查询接入码发送查询消息。查询的时间与分页相同（见第2.4.3节）。

### 2.5.4查询响应时间

在从设备接收到查询消息后，查询响应数据包从从设备发送到主站（见表8.5）。该数据包包含查询主机访问从设备所需的信息（请参见第6.5.1.4节中FHS数据包的定义），并遵循625？收到查询讯息后。如果从机发送一个扩展的查询响应数据包，它将被发送到1250？在查询响应包开始之后。

在图2.10和图2.11中，f（k）用于查询跳频序列的频率，f'（k）表示相应的查询响应序列频率。当从机接收到的询问消息首先在主机到从机时隙时，查询响应分组和扩展查询响应分组由主机以跳频f'（k）接收。

图2.10：上半场成功查询查询响应报文的时序

当从机接收到的查询消息是主机到从机时隙中的第二个时，查询响应分组和扩展查询响应分组由主机以跳频f'（k + 1）接收。

图2.11：下半场查询成功查询响应报文的时序

## 2.6 HOP选择

蓝牙设备将使用如以下部分中定义的跳频内核。

总共有六种类型的跳频序列被定义？5个用于基本跳跃系统，一个用于由自适应跳频（AFH）使用的适配的跳跃位置集合。这些序列是：

- 具有32个唤醒频率的页面跳频序列，均匀分布在79 MHz，周期长度为32;
- 覆盖与当前页跳频序列一一对应的32个响应频率的页响应跳频序列。主从使用不同的规则来获得相同的顺序;
- 具有32个唤醒频率的查询跳频序列，均匀分布于79 MHz，周期长度为32;
- 查询响应跳频序列，覆盖与当前查询跳频序列一一对应的32个响应频率。
- 具有非常长的周期长度的基本信道跳频序列，其在短时间间隔内不显示重复模式，并且在短时间间隔内在79MHz上均匀地分配跳频。
- 从使用相同信道机制并且可以使用少于79个频率的基本信道跳频序列导出的适配信道跳频序列。适用的信道跳频序列仅用于代替基本信道跳频序列。所有其他跳频序列不受跳序适应的影响。

另外，定义了具有3个固定频率的一组同步列车RF信道。

### 2.6.1一般选择方案

选择方案由两部分组成：

- 选择序列;
- 将该序列映射到跳频;

跳数选择方案的一般框图如图所示
### 2.12。在选择框中执行从输入到特定RF信道索引的映射。

选择框的输入是选定的时钟，冻结时钟，N，koffset，interlace_offset，地址，序列选择和AFH_channel_map。时钟源的来源取决于所选择的跳频序列。
另外，每个跳频序列使用时钟的不同位（见表2.2）。N，interlace_offset和koffset在2.6.4节中定义。
序列选择输入可以设置为以下值：

- 页面扫描
- 查询扫描
- 页面
- 查询
- 主页响应
- 从页面响应
- 查询回复
- 基本渠道
- 适应频道

地址输入包括28位，包括整个LAP和UAP的4个LSB。这被指定为UAP/LAP。当选择基本或适配的信道跳频序列时，应使用主机的蓝牙设备地址（BD_ADDR）。当选择页面，主页响应，从设备页面响应或页面扫描跳变序列时，应使用分页设备的主机给出的BD_ADDR（请参见“HCI创建连接命令”（第2卷）E部分，第7.1.5节） 。当选择查询，查询响应或查询扫描跳频序列时，即使涉及到DIAC，也应使用与GIAC对应的UAP/LAP。只要有一个保留的BD_ADDR（见第1.2.1节）用于产生跳频序列，则UAP将被默认的检查初始化（DCI，见第7.1节）所代替。通过序列选择输入到选择框来选择跳频序列。

当选择适配的信道跳频序列时，AFH_channel_map是选择框的附加输入。AFH_channel_map指示应使用哪些通道，哪些通道不被使用。这些术语在第2.6.3节中定义。


图2.12：跳选择方案的一般框图

输出RF信道索引构成伪随机序列。RF信道索引使用[Vol 2] Part A，Table 2.1中的等式映射到RF信道频率。

选择方案选择跨越大约64MHz的32跳频率的段，并以伪随机顺序访问这些跳。接下来，选择不同的32跳段，在页面中，主页响应，从设备页响应，页扫描，查询，查询响应和查询扫描跳频序列，同时使用同一32跳段该段由地址选择;不同的设备将具有不同的寻呼段）。当选择基本的信道跳频序列时，输出构成通过79跳跳过的伪随机序列。原理如图2.13所示。

图2.13：Hop选择方案在CONNECTION状态

RF频率在数据包的持续时间内应保持固定。分组的RF频率应从数据包的第一个时隙中的蓝牙时钟值导出。多时隙分组后的第一个时隙中的RF频率应使用由该时隙的蓝牙时钟值确定的频率。图2.14显示了单槽和多槽数据包的跳频定义。

图2.14：单槽和多槽数据包

当使用适配的信道跳频序列时，伪随机序列仅包含由AFH_channel_map输入定义的RF信道集合中的频率。适应序列具有与非适配跳跃序列相似的统计特性。此外，从器件在与主器件使用的相同RF信道上的数据包进行响应，以解决该从器件（或者在没有有效接收的主器件到从器件传输的同时保留时隙的情况下）。这称为AFH的相同通道机制。因此，用于主从分组的RF信道也用于紧随其后的从主分组。图中示出了相同通道机构的示例
### 2.15。每当选择适应的信道跳频序列时，应使用相同的信道机制。

图2.15：相同通道机制的示例

### 2.6.2选择内核

基本跳选择内核应如图2.16所示，用于页面，页面响应，查询，查询响应以及基本的跳频选择内核。在这些子状态中，AFH_channel_map输入未使用。第2.6.3节介绍了适配的跳频选择内核。

X输入确定32跳段中的相位，而Y1和Y2在主从到和从至主之间选择。输入A至D确定段内的排序，输入E和F确定到跳频上的映射。内核寻址包含RF信道索引的寄存器。该列表被排序，使得首先列出所有甚至RF信道索引，然后列出所有奇跳频率。这样一来，一个32-hop段跨越64MHz。

图2.16：跳跃系统的基本跳选择内核的框图

选择过程包括加法，异或运算，置换运算，加法运算，最后是寄存器选择。在本章的其余部分，符号Ai用于BD_ADDR的位i。

#### 2.6.2.1第一次添加操作

第一个加法运算仅向相位增加一个常数，并应用模32运算。对于页面跳频序列，第一次添加是冗余的，因为它仅改变段内的相位。然而，当不同段被级联时（如在基本信道跳频序列中），第一加法运算将对所得到的序列产生影响。

#### 2.6.2.2异或运算

令Z'表示第一次加法的输出。在异或运算中，Z'的四个LSB被加到地址位A22-19上。操作如图2.17所示。

图2.17：跳跃系统的异或运算

#### 2.6.2.3排列操作

置换操作涉及由控制字控制的跳跃系统的5个输入到5个输出的切换。置换或切换框应如图2.18所示。它由七个阶段的蝴蝶操作组成。控制信号P对蝴蝶的控制如表2.1所示。P0-8对应于D0-8，并且Pi + 9对应于图2.16中i = 0 ... 4的Ci Y1。


表2.1：跳跃系统蝴蝶的控制

Z输入是上一节所述的异或运算的输出。蝶形操作可以用多路复用器实现，如图2.19所示。

图2.18：跳跃系统的排列操作

图2.19：蝴蝶实施

#### 2.6.2.4第二次添加操作

加法运算选择当前段使用的跳频，并在主从到和从至主之间切换。它增加当前排列的输出（其选择段内的通道），常数，时钟位选择主器件或从器件时隙，以及用于将每个段切换到连接状态下的新的通道组的值。加法应用模79。

#### 2.6.2.5注册银行

加法器的输出寻址一组79个寄存器。这些寄存器加载了与跳频0至78对应的合成器码字。注意，组的上半部分包含偶数跳频率，而组的下半部分包含奇跳频率。

### 2.6.3适应跳选择内核

适应的跳选择内核基于前面部分中定义的基本跳选择内核。

除了使用输入AFH_channel_map（在Link Manager Protocol [Vol 2] C部分5.2节中定义）之外，适配跳跃选择内核的输入与基本跳跃系统内核相同。AFH_channel_map指示应使用哪些RF信道，哪些RF信道不被使用。当启用跳跃序列适配时，所使用的RF信道的数量可以从79减少到更小的值N.所有设备都应该能够
在具有N min的适应跳跃序列（AHS）N ??79，AFH_channel_map内的所有使用的RF信道的任何组合满足该约束。Nmin在2.3.1节中定义。

通过根据图2.16的基本信道跳频序列的两个添加来实现跳频序列的适配：

- 未使用的RF信道被均匀地重新映射到所使用的RF信道上。也就是说，如果基本系统的跳跃选择内核产生未使用的RF信道，则在所选择的RF信道集合中的替代RF信道被伪随机地选择。
- 为主从分组生成的使用RF信道也用于紧随从设备从设备分组（见第2.6.1节）。

#### 2.6.3.1通道重映射功能

当选择适配的跳选择内核时，根据图2.16的基本跳选择内核最初用于确定RF信道。如果该RF信道根据AFH_channel_map未使用，则未使用的RF信道通过重映射功能重新映射到所使用的RF信道之一。如果由基本跳选择核确定的RF信道已经在所使用的RF信道的集合中，则不进行调整。（非适配）基本跳跃的跳跃序列等于在基本跳跃产生所使用的RF信道的所有位置处的适配选择内核的序列。该属性便于所有从机仍保持同步，即使它们不是全部使用相同的跳频序列。

重新映射机制的框图如图2.20所示。重映射功能是从图2.16中选择内核的后处理步骤，表示为“跳跃选择基本跳”。输出fk的基本
跳频选择内核是范围在0到78之间的RF通道号。
该RF信道将在所使用的RF信道的集合中
未使用的RF信道。

图2.20：自适应跳选择机制框图

当由基本跳选择机制生成未使用的RF信道时，如下所述将其重新映射到所使用的RF信道集合。一个新的索引k'?? {0，1，...，N-1}使用来自基本跳选择内核的一些参数来计算：

k'=（PERM5out + E + F'+ Y2）mod N

其中F'在表2.2中定义。索引k'然后用于从包含所有偶数使用的RF信道的映射表中选择重新映射的信道，其按升序跟随所有奇数使用的RF信道的升序（即，图2.16的映射表所有未使用的RF通道被去除）。

### 2.6.4控制字

在下面的部分Xj-i中，i <j表示比特向量X的比特i，i + 1，...，j。按照惯例，X0是向量X的最低有效位。
内核的控制字由总体控制信号X，Y1，Y2，A到F和F'控制，如图2.16和图2.20所示。在寻呼和查询期间，输入A至E使用表2.2相应列中给出的地址值。此外，使用输入X，Y1和Y2。F和F'输入未使用。时钟位CLK6-2（即输入X）
指定长度32序列中的相位。CLK1（即输入Y1和Y2）
用于在TX和RX之间进行选择。地址输入决定
段内的序列顺序跳频的最终映射由寄存器内容确定。

在CONNECTION状态（参见第8.5节）中，输入A，C和D应从与表2.2的“连接状态”列中所示的时钟位进行逐位异或运算的地址位中得出（两个最重要的位，MSB，被异或在一起，两个第二MSB一起被异或等）。

表2.2：跳跃系统的控制

五个X输入位根据设备的当前状态而变化。在页面扫描和查询扫描子状态中，应使用本机时钟（CLKN）。在CONNECTION状态下，主时钟（CLK）用作输入。其他国家的情况有些复杂。

#### 2.6.4.1页面扫描和查询扫描顺序

当序列选择输入设置为页面扫描时，扫描设备的蓝牙设备地址应用作地址输入。当序列选择输入设置为查询扫描时，GIAC LAP和DCI的四个LSB（作为A27 - 24）应用作跳频的地址输入
序列。对于发送的接入码，在接收机相关器中，应使用相应的GIAC或DIAC。应用程序根据查询的目的决定使用哪个查询接入码。

#### 2.6.4.2页面跳转序列

当序列选择输入设置为页面时，寻呼设备应启动

使用A列车，即

？f（k-8）F（k）的?????f（k + 7）？

，哪里

f（k）是源的

对分页设备中当前接收机频率的估计。索引k是图2.16中所有输入的函数。每个1.28秒间隔内有32个可能的寻呼频率。这些频率中有一半属于

到A列车，其余的（即，

？f（k + 8）f（k + 15）??f（k-16）f（k-9）？

）属于

到B列车。为了实现A列的-8偏移，应将24的常数加到时钟位（由于模32操作而相当于-8）。通过将偏移量设置为8来获得B列。在接收到第一从设备响应的时隙周期性不可用的情况下，向时钟比特添加额外的偏移量（knudge），以使列车移动1.25ms持续时间的整数倍。为了避免分页和扫描设备之间可能的重复不匹配，列车内的顺序的循环移位也是必需的。从而，

（EQ 2）

哪里

（EQ 3）

（EQ 4）

即使在所有其他重复。

或者，A和B列之间的每个开关可以通过将k加到当前值koffset（最初用24初始化）来实现。

#### 2.6.4.3从设备页面响应跳转序列

当序列选择输入设置为从设备页面响应时，为了消除由于本机时钟CLKN和主机时钟估计CLKE的差异导致的链路丢失的可能性，四位CLKN16-12将被冻结在其当前值。该值应冻结在检测到接收方接入码的插槽中的内容上。本地时钟不得停止;它只是用于创建保持固定一段时间的X输入的位的值。冻结值在下面的讨论中用星号（*）表示。

对于每个响应时隙，寻呼设备将使用比前一个响应时隙更大（模32）的X输入值。然而，第一个响应应该与X输入保持在与识别接入码时相同的值。让N是从零开始的计数器。那么，X输入在？从响应子状态的N + 1 ??个响应时隙（紧接在现在响应的页面时隙之后的第一个响应时隙）是：


（EQ 5）

计数器

应在从设备确认的时隙中设置为零

页面（见图8.3和图8.4）。那么，N的值

每次CLKN1设置为零时，每增加一个，这对应于主TX时隙的开始。X输入端应以这种方式构成，直到接收到第一个FHS数据包并且发送了紧随其后的响应数据包。之后，从机将使用FHS数据包中接收到的参数进入CONNECTION状态。

#### 2.6.4.4主页响应跳跃序列

当序列选择输入设置为主页响应时，主机将其估计的从时钟冻结到触发从分页设备的响应的值。相当于在接收到从响应时使用时钟估计值（因为只有CLKE1将不同于相应的页面传输）。因此，当接收到从ID ID分组时，这些值被冻结。除了使用的时钟位之外，还将冻结koffset和knudge的当前值。主机将以与分页设备相同的方式调整其X输入，即每次CLKE1设置为零时，将该值递增1。在将FHS分组发送到分页设备之前，应先进行增量。让N
一。形成X输入的规则是：

（EQ 6）

每当CLKE1设置为零时，N的值将增加，这对应于主TX时隙的开始。

#### 2.6.4.5查询跳转序列

当序列选择输入设置为查询时，X输入与页面跳变序列中使用的类似。由于没有寻址到特定的设备，所以使用查询器的本地时钟CLKN。而且，这两个火车偏离哪一个开始在这个状态下并不是真正关心的。所以，

（EQ 7）

其中koffset和knudge由（EQ 3）和（EQ 4）定义。

koffset的初始选择是任意的。

GIAC LAP和DCI的四个LSB（作为A27 - 24）应用作跳频序列发生器的地址输入。

#### 2.6.4.6查询响应跳转序列

查询响应跳变序列类似于相对于X输入的从页响应跳变序列。时钟输入不得冻结，因此适用以下公式：

（EQ 8）

此外，计数器N不是以CLKN1为基础增加，而是在响应于查询发送每个FHS分组之后。查询单位N值的初始值没有限制。

用于扩展查询响应数据包的Xir值应与前一个FHS数据包计算的Xir值相同。

GIAC LAP和DCI的四个LSB（作为A27 - 24）应用作跳频序列发生器的地址输入。发生器的其他输入位应与页面响应相同。

#### 2.6.4.7基本和适应的信道跳转序列

在基本和适应的信道跳频序列中，用于基本或适配的跳频序列生成的时钟位将始终从主时钟CLK导出。地址位应从主站的蓝牙设备地址导出。

#### 2.6.4.8同步列车射频通道

同步序列和同步扫描使用来自具有索引0,24和78的三个固定RF信道的集合的RF信道。

## 2.7同步扫描物理通道

同步扫描物理信道使设备能够接收同步列车数据包。

### 2.7.1跳跃特性

当设备进入同步扫描子状态时，应使用第2.7.3节定义的定时来扫描同步列RF通道。每个单独的扫描窗口应使用与前两个扫描窗口不同的RF通道。

同步扫描物理信道应使用第2.6.4.8节中定义的所有同步列RF通道。

### 2.7.2同步列车程序时序

只有在CSB（Connectionless Slave Broadcast，无连接从设备广播）模式启用或粗调时钟调整恢复模式（第8.6.10.2节）时，主机才应使用同步列程序。这些可以同时发生。在同步列车程序期间，主机应尝试在第2.6.4.8节中规定的所有RF通道上发送同步列车数据包。在每个RF信道上传输同步列分组与其他RF信道上的传输无关。对于每个射频通道，主机应：

1。建立由TSync_Train_Interval插槽分隔的同步列车事件。在粗调时钟调整恢复模式下，TSync_Train_Interval的值应为32。在所有其他时间，它应是控制员从主机提供的范围（[Vol 2] E部分，第3.3.90节）中选择的值。
2。尝试在每对同步火车事件之间发送同步列车数据包。
3。在没有调度冲突的情况下，延迟来自同步列车事件的TSync_Train_Delay时隙的同步列车分组传输的开始，其中TSync_Train_Delay是在0和TSync_Train_Delay_Max之间的伪随机数。TSync_Train_Delay的每个值都应该是一个偶数整数。在“粗调时钟调整恢复模式”期间，TSync_Train_Delay_Max应等于4个时隙，其余时间应为16个时隙。每个同步分组传输应在CLK [1：0] = 00b的时隙开始处开始。
4。如果同步列分组的传输与较高优先级分组的定时相冲突，则可以调整实际延迟以避免冲突。实际延迟应保持在0到TSync_Train_Delay_Max（含）的范围内，不得大于或等于TSync_Train_Interval。如果在下一个同步列车事件之前不可能发送完整的数据包，则不会发送。请注意，将延迟超出推荐范围（0到TSync_Train_Delay_Max）增加扫描设备将错过数据包的机会。
5。在任何两个连续的同步列车事件之间不得有多于一个的同步列车包。
6。对于任何三个连续的同步列车包（尽管有两个可能是），使用的实际延迟并不全部相同。

注意：根据上述要求，不同RF信道上的同步列车事件可以单独管理，也可以使用相同的TSync_Train_Delay值进行协调。

图2.21显示了单个RF通道上连续的同步列车数据包的时序关系。

图2.21：在单个通道上同步列车分组定时

### 2.7.3同步扫描程序时序

在同步扫描过程中，设备在同步列车RF信道上执行同步扫描。在每个扫描窗口期间，设备将侦听TSync_Scan_Window的持续时间。每个扫描窗口的RF通道应按第2.7.1节的规定进行选择。

每个扫描窗口应该是连续的，不会被其他活动中断。连续扫描窗口开始间隔应等于
TSync_Scan_Interval。TSync_Scan_Window和TSync_Scan_Interval的值应如下所示选择：

- 在CSB（Connectionless Slave Broadcast，无连接从设备广播）期间，请参阅[第2卷] E部分，第7.1.52节。
- 在粗调时钟调整恢复模式下，所选择的值是实现特定的。

该时序关系如图2.22所示。

图2.22：同步扫描时序

#3物理链接

物理链路表示设备之间的基带连接。物理链路总是与一个物理通道相关联。物理链路具有适用于物理链路上的所有逻辑传输的公共属性。

除了CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路，物理链路的常见属性是：

- 功率控制（见[Vol 2] C部分，第4.1.3节）
- 链接监督（见3.1和[第2卷] C部分，第4.1.6节）
- 加密（参见[Vol 2] Part H，Section 4 and [Vol 2] C部分，第4.2.5节）
- 频道质量驱动的数据速率变化（见[第2卷] C部分，第4.1.7节）
- 多时隙分组控制（参见[Vol 2] C部分，第4.1.10节）以及适配微微网物理信道上的物理链路：
- AFH频道图（见第2.3节和第[2卷] C部分，第4.1.4节）

CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路与BR/EDR适配的微微网物理信道，单一逻辑传输（CSB逻辑传输）相关联，并且不支持链路管理器协议。有关CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路的链路监控的信息，请参见第3.2节。CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路上的多时隙数据包由主机控制，并在配置文件级别指定。

## 3.1主动物理链接的链接监督

由于设备移动超出范围，遇到严重干扰或停电条件等各种原因，连接可能会分解。
由于这可以在没有任何预先警告的情况下发生，因此当逻辑传输地址（见第4.2节）重新分配给另一个从设备时，监视主站和从设备侧的链路以避免可能的冲突是很重要的。

为了能够检测到链路丢失，主设备和从设备都应使用链路监控定时器T监控。在物理链路上接收到其中一个从设备地址（见第4.2节）的有效分组报头时，定时器
应复位。如果在CONNECTION状态下，定时器达到监视值，连接将被视为断开连接。SCO，eSCO和ACL逻辑传输使用同一个链路监控定时器。

超时期间，监督TO由Link Manager协商。应选择其价值，使监督超时时间长于持有和嗅探期间。

## 3.2链接监控用于连接无源广播物理链路

对于CSB（Connectionless Slave Broadcast，无连接从设备广播）物理链路，只有从设备监视链路。为了检测链路丢失，从设备应使用链路监控
定时器，TCSB_Supervision。每个无连接从播广播从设备将在接收到具有有效分组报头的无连续从广播分组时复位定时器。如果在任何时候无连接的从设备广播模式
CONNECTION状态下，定时器达到CSB_supervisionTO值，连接应视为断开连接。

对于每个从设备，主机将提供超时时间段CSB_supervisionTO。

## 3.3激活链路的认证PAYLOAD超时

对于活动的物理链路，当启用加密和使用AES-CCM时，设备将监视从包含MIC的远程设备接收数据包之间的时间。为了确保链接的完整性，使用了已认证的有效载荷定时器TAuthenticated_Payload。每个设备在接收到具有有效MIC的数据包时，应重置定时器。如果在CONNECTION状态的任何时候，定时器到达authenticatedPayloadTO值，则通知主机。超时时间，authenticatedPayloadTO由主机提供。

每次通知主机后，设备将重置定时器。当主机写入authenticatedPayloadTO值时，控制器将复位定时器。

#4 LOGICAL TRANSPORTS

## 4.1一般

在主机和从机之间，可以建立不同类型的逻辑传输。已经定义了五个逻辑运输：

- 同步面向连接（SCO）逻辑传输
- 扩展的同步面向连接（eSCO）逻辑传输
- 异步连接（ACL）逻辑传输
- 主动从设备广播（ASB）逻辑传输
- 无连接从播广播（CSB）逻辑传输。

同步逻辑传输是微微网中主站和单个从设备之间的点对点逻辑传输。同步逻辑传输通常支持时间有限的信息，如语音或一般同步数据。主机通过定期间隔使用保留时隙来维护同步逻辑传输。除了保留时隙之外，eSCO逻辑传输可以在保留时隙之后具有重传窗口。

ACL逻辑传输也是主机和从机之间的点到点逻辑传输。在不保留用于同步逻辑传输的时隙中，主机可以在每个时隙的基础上建立ACL逻辑传输，包括已经从事同步逻辑传输的从机。

主控台使用ASB逻辑传输与主动从设备进行通信。

主机使用CSB逻辑传输来将配置文件广播数据发送到零个或多个从设备。

## 4.2逻辑运输地址（LT_ADDR）

在微微网中活动的每个从设备被分配一个主3位逻辑传输地址（LT_ADDR）。全零LT_ADDR保留用于ASB广播消息。CSB逻辑传输使用单个非零LT_ADDR。主人没有LT_ADDR。主人相对于奴隶的时间与奴隶有所不同。对于在微微网中使用的每个eSCO逻辑传输，辅助LT_ADDR被分配给从设备。次要LT_ADDR不得为0。只有eSCO流量（即，NULL，POLL以及在eSCO逻辑传输设置中协商的EV数据包类型之一）可以在这些LT_ADDR上发送。ACL流量（包括LMP）应始终在主LT_ADDR上发送。从设备只能接受具有匹配的主要或次要LT_ADDR和广播数据包的数据包。LT_ADDR在数据包头中携带（参见第6.4节）。只要从设备处于活动模式，LT_ADDR只能有效。一旦断开连接，从机将丢失所有的LT_ADDR。

当从机被激活时，主器件将由主器件分配给从器件。这是在连接建立或角色切换时，主要LT_ADDR在FHS有效载荷中承载。

在任何给定的时间，LT_ADDR（除了全零LT_ADDR的特殊情况）未使用，或者仅用于从设备主地址的三个目的之一，eSCO流量的辅助地址或用于CSB逻辑运输。因此，为eSCO逻辑传输分配辅助LT_ADDR或为CSB逻辑传输预留LT_ADDR可减少微微网中可能的最大活动从设备数。

##同步逻辑运输

第一种类型的同步逻辑传输（SCO逻辑传输）是主机和特定从机之间的对称的点对点传输。SCO逻辑传输保留时隙，因此可以被认为是主机与从机之间的电路交换连接。主机可以支持多达三个到同一个从设备或不同从设备的SCO链路。如果链路源于不同的主设备，则从设备可以支持来自同一主站的三个SCO链路，或两个SCO链路。SCO数据包从不重传。

第二种类型的同步逻辑传输，即eSCO逻辑传输，是主机与特定从机之间的点到点逻辑传输。 eSCO逻辑传输可能是对称的或不对称的。与SCO类似，eSCO保留插槽，因此可以被认为是主机和从机之间的电路交换连接。除了保留时隙之外，eSCO还支持紧随预留时隙的重传窗口。保留时隙和重传窗口共同组成了完整的eSCO窗口。

## 4.4异地逻辑运输

在不保留用于同步逻辑传输的时隙中，主机可以在每个时隙的基础上与任何从机交换数据包。ACL逻辑传输提供主控和所有活动从设备单元之间的分组交换连接。支持异步和等时服务。在主机和从机之间只存在单个ACL逻辑传输。对于大多数ACL数据包，应用数据包重传来确保数据完整性。

不寻址到特定从设备（LT_ADDR = 0）的ACL数据包被认为是广播数据包，除了只有CSB逻辑传输的从设备之外，每个从设备都应该接收到这些数据包。如果ACL逻辑传输中没有要发送的数据，并且不需要轮询，则不需要传输。

## 4.5发送/接收程序

本节介绍如何使用第6节定义的报文，以支持ACL，SCO和eSCO逻辑传输的流量。考虑单从机和多从机配置。另外，描述了使用用于TX和RX例程的缓冲器。

4.5.1和4.5.2节中描述的TX和RX例程仅供参考。

### 4.5.1 TX例程

针对每个异步和同步逻辑传输分别执行TX例程。图4.1显示了TX例程中使用的异步和同步缓冲区。在该图中，仅示出了单个TX异步缓冲器和单个TX同步缓冲器。在主机中，每个从机都有一个独立的TX异步缓冲器。此外，每个同步从设备可以有一个或多个TX同步缓冲区（不同的SCO或eSCO逻辑传输可以重用相同的TX同步缓冲区，或者每个具有自己的TX同步缓冲区）。每个TX缓冲区由两个FIFO寄存器组成：一个当前寄存器，可由Link Controller访问和读取，以便组成数据包;另一个寄存器可由基带资源管理器访问以加载新信息。开关S1和S2的位置确定哪个寄存器是当前的，哪个寄存器是下一个;开关由Link Controller控制。FIFO寄存器的输入和输出中的开关不能同时连接到同一个寄存器。

图4.1：TX缓冲功能框图

在ACL和SCO逻辑传输（NULL，POLL和DM1）上公用的数据包中，只有DM1数据包携带链路控制器和链路管理器之间交换的有效载荷;该公共数据包使用异步缓冲区。所有ACL数据包都使用异步缓冲区。所有SCO和eSCO数据包都使用同步缓冲器，除了同步数据部分由同步缓冲器处理的DV数据包之外，数据部分由异步缓冲区处理。在接下来的章节中，描述了SCO逻辑传输中的ACL流量，SCO流量，eSCO流量和组合数据语音流量的操作。

#### 4.5.1.1 ACL流量

在异步数据的情况下，必须考虑图4.1中的TX ACL缓冲区。在这种情况下，仅使用分组类型DM或DH，并且它们可以具有不同的长度。长度在有效载荷头部中指示。DM或DH数据包的选择取决于链路的质量。见[第2卷] C部分，第4.1.7节。

纯数据流量中的默认数据包类型为NULL（见第6.5.1.2节）。这意味着，如果没有要发送的数据（数据流量是异步的，因此发生没有数据可用的暂停），或者不需要轮询从设备，则会发送NULL数据包？以便向其他设备发送链路控制信息（例如，用于接收到的数据的ACK/STOP信息）。当没有链路控制信息可用（无需确认和/或不需要停止RX流）时，根本不发送任何数据包。
TX例程的工作原理如下。基带资源管理器在交换机S1a指向的寄存器中加载新的数据信息。接下来，它向Link Controller发出一个命令，该控制器迫使开关S1改变（S1a和S1b都同步切换）。当需要发送有效载荷时，分组编辑器读取当前的寄存器，根据分组类型，构建附加到信道接入码和报头的随后发送的有效载荷。在响应分组中（如果涉及主传输则到达下一个RX时隙，或者如果涉及从设备传输，则可以推迟到稍后的RX时隙），则传送结果被报告回来。在ACK的情况下，开关S1改变位置;如果接收到NAK（显式或隐式），则开关S1不会改变位置。在这种情况下，在下一个TX时刻重传相同的有效载荷。

只要基带资源管理器不断向寄存器加载新的信息，链路控制器将自动发送有效载荷;此外，在发生错误的情况下自动执行重传。当没有新的数据被加载时，链路控制器将发送NULL或者没有。如果在下一个寄存器中没有加载新的数据，则在上一次传输期间，在最后一次传输被确认并且下一个寄存器成为当前寄存器之后，数据包编辑器将指向一个空寄存器。如果在下一个寄存器中加载新数据，则需要刷新命令才能将S1开关切换到正确的寄存器。只要基带资源管理器在每个TX时隙之前持续加载数据和类型寄存器，则数据由链路控制器自动处理，因为S1切换由响应中接收到的ACK信息控制。
但是，如果来自基带资源管理器的流量中断一次并且发送了默认数据包，则需要刷新命令以在链路控制器中继续流动。

在时间有限（等时）数据的情况下也可以使用刷新命令。在链路不良的情况下，需要进行许多重传。在某些应用中，数据是有时限的：如果由于链路错误一直重传有效载荷，则可能会变得过时，并且系统可能决定继续使用更新的数据，并跳过未通过的有效载荷。这也是通过flush命令完成的。在刷新时，开关S1被强制改变，并且链路控制器被强制考虑下一个数据有效载荷并推翻ACK控制。可以使用任何ACL类型的数据包将数据或链路控制信息发送到任何其他ACL从设备。

#### 4.5.1.2 SCO流量

在SCO逻辑传输中，仅使用HV和DV数据包类型，请参见第6.5.2节。同步端口可以连续加载下一个寄存器
同步缓冲区。S2开关根据Tsco间隔进行更改。在建立SCO逻辑传输时，该主机与从机之间协商此Tsco间隔。

对于每个新的SCO插槽，分组编辑器读取当前的寄存器，之后更改S2开关。如果SCO时隙必须用于发送主控和从SCO从设备之间的控制分组的高优先级控制信息，或主机与其他从机之间的控制分组，则分组编辑器将丢弃SCO信息并使用控制信息。该控制信息应以DM1包发送。也可以通过使用DV或DM1数据包在主机和SCO从机之间交换数据或链路控制信息。

#### 4.5.1.3混合数据/语音流量

在6.5.2节中，已经定义了一个可以在单个SCO逻辑传输上同时支持数据和语音的DV数据包。当TYPE为DV时，链路控制器读取数据寄存器以填充数据字段和语音寄存器以填充语音字段。之后，改变开关S2。然而，S1的位置取决于传输的结果如ACL逻辑传输：只有当接收到ACK时，S1开关才会改变其位置。在每个DV分组中，语音信息是新的，但是如果先前的传输失败，则可能重传数据信息。如果没有数据发送，则SCO逻辑传输将自动从DV数据包类型改变为混合数据/语音传输之前使用的当前HV数据包类型。请注意，当数据流已被中断并且新数据到达时，需要刷新命令。

如果通道容量允许，也可以通过使用除SCO逻辑传输之外的单独的ACL逻辑传输来实现组合的数据语音传输。

#### 4.5.1.4 eSCO流量

在eSCO逻辑传输上，仅使用EV，POLL和NULL数据包类型，请参见第6.5.3节。同步端口可以连续加载同步缓冲区中的下一个寄存器。S2开关根据变化
TeSCO间隔。在建立eSCO逻辑传输时，该主机与从机之间的TeSCO间隔协商。

对于每个新的eSCO插槽，数据包编辑器读取当前的寄存器，之后S2开关被更改。如果必须使用eSCO插槽来发送主机和eSCO从设备之间的控制报文，或者主设备与其他从设备之间的ACL报文高优先级的控制信息，则报文作曲家将丢弃eSCO信息，并使用控制信息。对eSCO从设备的控制信息在主LT_ADDR上的DM1报文中发送。

#### 4.5.1.5默认数据包类型

在ACL链接上，主机和从机的默认类型始终为NULL。这意味着如果不需要发送用户信息，如果存在ACK或STOP信息，或者根本没有发送数据包，则会发送NULL数据包。主数据包可以使用NULL数据包将下一个从设备主机插槽分配给某个从机（即一个从机）。但是，从设备不会强制对主机的NULL报文进行响应。如果主机需要响应，则发送一个POLL数据包。

当SCO或eSCO逻辑传输建立时，SCO和eSCO分组类型在LM级协商。约定的数据包类型也是保留的SCO或eSCO插槽的默认数据包类型。

### 4.5.2 RX例程

对于ACL逻辑传输和同步逻辑传输，分别执行RX例程。然而，与主TX异步缓冲器相反，所有从机之间共享一个RX缓冲区。对于同步缓冲区，如何区分不同的同步逻辑传输取决于是否需要额外的同步缓冲区。图4.2显示了RX例程中使用的异步和同步缓冲区。RX异步缓冲器由两个FIFO寄存器组成：一个可由链路控制器访问和加载的最新RX数据包的有效载荷的寄存器和一个可由基带资源管理器访问以读取先前有效载荷的寄存器。RX同步缓冲器还包括两个FIFO寄存器：一个填充有新到达的语音信息的寄存器和一个可由语音处理单元读取的寄存器。

图4.2：RX缓冲功能框图

由于接收到的分组的头部（见第6.4.2节）中的TYPE指示指示有效载荷是否包含数据和/或语音，所以分组解组件可以自动将流量指向适当的缓冲区。每次基带资源管理器读取旧的寄存器时，开关S1都会发生变化。如果在RX寄存器被清空之前下一个有效负载到达，则在返回的下一个TX包的包头中包含STOP指示。RX寄存器清空后，再次清除STOP指示。在新的ACL有效负载被存储到异步寄存器之前检查SEQN字段（LLID中的刷新指示和广播消息影响SEQN字段的解释参见7.6节）。

每个TSCO或TeSCO分别为SCO和eSCO改变S2开关。如果由于报头中的错误，没有新的同步有效载荷到达，则交换机仍然改变。然后同步数据处理单元
处理同步数据以解决缺失的部分。

### 4.5.3流量控制

由于在新的负载到达时，RX ACL缓冲区可以满载，因此需要流量控制。返回TX分组中的报头字段FLOW可以使用STOP或GO来控制新数据的传输。

#### 4.5.3.1目的地控制

只要无法接收到数据，就会发送停止指示，将其自动插入到链路控制器的报头中。只要RX ACL缓冲区未被基带资源管理器清空，则应返回STOP。再次接受新数据时，应返回GO指示。GO应为默认值。仍然可以接收不包括数据的所有数据包类型。语音通信不受流量控制的影响。虽然设备不能接收新的信息，但它仍然可以继续传输信息：流量控制对于每个方向应是分开的。

#### 4.5.3.2源代码管理

在接收到STOP信号时，Link Controller将自动切换到默认数据包类型。在接收STOP指示之前发送的ACL数据包将被保留，直到接收到GO信号。一旦接收到GO指示，就可以重新发送。只要接收到停止指示，才发送默认数据包。当没有收到数据包时，应隐含地假设GO。注意，默认分组包含用于接收方向的链路控制信息（在报头中）（可能仍然是打开的），并且可以包含同步数据（HV或EV分组）。当接收到GO指示时，链路控制器可以恢复发送存在于TX ACL缓冲器中的数据。

在多从机配置中，只有发出STOP信号的从机的传输才会停止。这意味着主机只能停止从对应于从设备的TX ACL缓冲区的传输，暂时不能接收数据。

## 4.6主动从设备广播传输

主动从广播逻辑传输用于将L2CAP用户流量和某些LMP流量传输到当前连接到由ASB使用的微微网物理信道的微微网中的所有设备。没有确认协议，并且流量从微微网主机到从设备是单向的。ASB逻辑传输只能用于L2CAP组流量，不得用于L2CAP面向连接的信道或L2CAP控制信令。

ASB逻辑传输是不可靠的。为了提高可靠性，有些每个数据包被传送多次。使用相同的序列号来辅助从设备处的过滤重传。

ASB逻辑传输由保留的全零LT_ADDR标识。 ASB逻辑传输中的数据包可以由主机随时发送。

## 4.7此部分不再使用


## 4.8无连接顺序广播逻辑运输
CSB逻辑传输用于将配置文件广播数据从主机传输到多个从设备。没有确认方案，流量是单向的。注意：CSB逻辑传输不用于L2CAP面向连接的信道，L2CAP控制信令或LMP控制信令。

CSB的逻辑运输是不可靠的。为了提高可靠性，每个分组有效载荷可以被多次发送。

#5 LOGICAL LINKS


定义了以下逻辑链接：

- 链路控制（LC）
- ACL控制（ACL-C和ASB-C）
- 用户异步/同步（ACL-U和ASB-U）
- 用户同步（SCO-S）
- 用户扩展同步（eSCO-S）
- 简档广播数据（PBD）

在链路控制级使用控制逻辑链路LC。在链路管理器级使用ACL-C和ASB-C逻辑链路。ACL-U和ASB-U逻辑链路用于携带异步或同步用户信息。SCO-S和eSCO-S逻辑链路用于承载同步用户信息。PBD逻辑链路用于携带简档广播数据。LC逻辑链路在分组报头中承载，所有其他逻辑链路在分组有效载荷中承载。ACL-C，ACL-U，ASB-C和ASB-U逻辑链路在有效负载报头中的逻辑链路ID（LLID）字段中指示。SCO-S和eSCO-S逻辑链路仅由同步逻辑传输承载; ACL-U链路通常由ACL逻辑传输携带;然而，它也可以由SCO逻辑传输中的DV分组中的数据携带。ACL-C链路可以由SCO或ACL逻辑传输来承载。ASB-C和ASB-U链路由ASB逻辑传输承载。PBD逻辑链路由CSB逻辑传输承载。

## 5.1 LINK CONTROL LOGICAL LINK（LC）

LC控制逻辑链路应映射到数据包头。该逻辑链路携带低级链路控制信息，如ARQ，流量控制和有效载荷表征。除了没有包头的ID分组之外，每个分组中携带LC逻辑链路。

## 5.2 ACL控制逻辑链路（ACL-C和ASB-C）

ACL-C和ASB-C逻辑链路应携带主站和从设备的链路管理器之间交换的控制信息。ACL-C逻辑链路应使用DM1或DV数据包。如果ACL-C消息小于或等于9字节，并且正在使用HV1同步逻辑传输，则只能在ACL-C链路上使用DV数据包。ASB-C逻辑链路应使用DM1报文。ACL-C和ASB-C逻辑链路由有效负载报头中的LLID代码11b指示。

## 5.3用户异步/异步逻辑链路（ACL-U和ASB-U）

ACL-U和ASB-U逻辑链路应携带L2CAP异步和同步用户数据。这些消息可以在一个或多个基带分组中发送。对于分片消息，起始包将在有效负载报头中使用10b的LLID码。剩余连续数据包应使用LLID代码01b。如果没有碎片，则所有数据包都将使用LLID起始码10b。

### 5.3.1暂停ACL-U逻辑链路

当LM暂停时，链路控制器发送具有ACL-U信息的当前数据包（如果有的话），直到接收到ACK。当ACL-U逻辑链路暂停时，链路控制器不得传输具有ACL-U逻辑链路信息的任何数据包。

如果ACL-U在ACK之后暂停，下一个数据包将使用下一个序列号。如果ACL-U在NAK之后暂停，则在下一个数据包中使用相同的序列号，一旦ACL-U逻辑链路未暂停，则应发送未确认的数据包。

当LM-U逻辑链路未暂停时，链路控制器可以重新发送ACL-U信息。

## 5.4用户同步数据逻辑链路（SCO-S）

SCO-S逻辑链路携带透明的同步用户数据。该逻辑链路通过同步逻辑传输SCO承载。

## 5.5用户扩展的同步数据逻辑链路（eSCO-S）

eSCO-S逻辑链路还携带透明的同步用户数据。该逻辑链路由扩展的同步逻辑传输eSCO承载。

## 5.6逻辑链接优先

ACL-C逻辑链路在调度共享ACL逻辑传输流量时，优先级高于ACL-U逻辑链路，除非在未知确认的ACL报文的重传优先级高于ACL-C逻辑上的流量的情况下链接。当在共享ASB逻辑传输上调度流量时，ASB-C逻辑链路的优先级要高于ASB-U逻辑链路。ACL-C逻辑链路也应优先于SCO-S和eSCO-S逻辑链路上的流量，但是应该采用交叉逻辑链路的机会。ACL-C，SCO-S和eSCO-S逻辑链路应优先于PBD逻辑链路上的流量。

## 5.7配置文件数据逻辑链接

PBD逻辑链路携带配置文件广播数据。消息不应该被分段，并且应始终使用LLID起始码10b。

#6包

蓝牙设备将使用以下各节中定义的数据包。

## 6.1一般格式

### 6.1.1基本速率

基本速率数据包的通用数据包格式如图6.1所示。每个分组由3个实体组成：接入码，报头和有效载荷。在图中，指示每个实体的比特数。

图6.1：通用基本速率数据包格式

访问码为72位或68位，标题为54位。有效载荷范围从零到最大2790位。已经定义了不同的数据包类型。数据包可能包括：

- 仅缩短接入码（见第6.5.1.1节）
- 接入码和数据包头
- 接入码，数据包头和有效载荷。

### 6.1.2增强数据速率

增强数据速率数据包的一般格式如图6.2所示。接入码和包头在格式和调制方式与基本速率数据包相同。增强数据速率数据包具有保护周期和数据包头之后的同步序列。有效载荷是两个拖车符号。第6.6节定义了保护周期，同步序列和报尾。

图6.2：通用增强数据速率数据包格式

## 6.2 BIT ORDERING

在定义数据包和消息时的位排序，遵循Little Endian格式。以下规则适用：

- 最低有效位（LSB）对应于b0;
- LSB是通过空中传送的第一位;
- 在插图中，LSB显示在左侧;

此外，在基带级内部生成的数据字段（如数据包头部字段和有效负载头部长度）应首先与LSB一起发送。例如，3位参数X = 3被发送为：

在空中首先发送1，最后发送0。

## 6.3接入码

每个数据包都以访问码开头。如果分组报头跟随，则接入码为72位长，否则接入码为68位长，被称为缩短的接入码。缩短的接入码不包含报尾。该接入码用于同步，直流偏移补偿和识别。接入码识别在物理信道上交换的所有数据包：在相同物理信道中发送的所有数据包之前都有相同的访问码。在设备的接收器中，当超过阈值时，滑动相关器与接入码相关联并触发。该触发信号用于确定接收定时。

缩短的接入码用于寻呼和查询。在这种情况下，接入码本身被用作信令消息，并且不存在报头和有效载荷。

接入码由前同步码，同步字和可能的报尾组成，见图6.3。详见6.3.1节。

图6.3：接入码格式

### 6.3.1接入码类型

不同的接入码类型使用不同的下部地址部分（LAP）来构造同步字。BD_ADDR的LAP字段在第1.2节中有说明。不同接入码类型的摘要见表6.1。

表6.1：接入码类型的总结

长度72仅与FHS数据包组合使用

CAC由前同步码，同步字和报尾组成，总长度为72位。当用作没有报头的自包含消息时，DAC和IAC不包括报尾位，长度为68位。

### 6.3.2序言

前导码是用于促进DC补偿的4个符号的固定零1模式。序列是'1010'或'0101'（按传输顺序），这取决于下一个同步字的LSB分别是1还是0。前导码如图6.4所示。

图6.4：前导码

### 6.3.3同步字

同步字是从24位地址（LAP）导出的64位代码字;对于CAC，使用主人的LAP;对于GIAC和DIAC，使用预留的专用LAP;对于DAC，使用从LAP。该建筑保证了基于不同LAP的同步字之间的大汉明距离。另外，同步字的良好的自相关特性提高了时序采集。

#### 6.3.3.1同步字定义

同步字基于具有64位全长伪随机噪声（PN）序列的覆盖（逐位XOR）的（64,30）消除的块码。消除的代码保证了基于不同地址的同步字之间的汉明距离（dmin = 14）。PN序列改善了自动
接入码的相关属性。以下步骤描述如何产生同步字：

1。生成信息序列;
2。与PN覆盖序列的“信息覆盖”部分进行异或处理;
3。生成码字;
4。将PN覆盖序列的所有64位的码字异或;

通过将6位附加到24位LAP生成信息序列

（步骤1）。附加位为001101

如果LAP的MSB等于0。如果

LAP的MSB为1，附加位为110010。LAP MSB与附加的位构成长度为7的巴克序列。包括Barker序列的目的是进一步改善自相关性质。在步骤2中，通过使用PN序列的位进行异或（第6.3.3.2节中的定义）对信息进行预加扰。生成后
码字（步骤3），完整的PN序列被异或到码字（步骤）
4）。该步骤解密了码字的信息部分。同时，码字的奇偶校验位被加扰。因此，原始LAP和Barker序列确保了作为接入码同步字的一部分的作用，并且删除了底层代码的循环属性。原理如图6.5所示。

在下面的讨论中，二进制序列将由它们相应的D变换表示（其中Di表示i个时间单位的延迟）。

图6.5：同步字的构造

（EQ 9）

（EQ 10）

（EQ 11）


用于创建长度为7个巴克序列。然后，通过以下步骤生成接入码：


#### 6.3.3.2伪随机噪声序列生成

为了产生PN序列，应使用原始多项式。LFSR及其启动状态如图6.6所示。产生的PN序列（包括额外的终止零）变为（十六进制符号）83848D96BBCC54FC。 LFSR输出以该PN序列的最左位开始。这对应

（EQ 12）


图6.6：LFSR和产生p'（D）的起始状态


x（D）mod y（D）表示当x（D）除以y（D）时的余数。

### 6.3.4报尾

一旦分组头跟随接入码，该拖尾就附加到同步字上。这通常是CAC的情况，但是当在页面响应和查询响应期间交换的FHS分组中使用这些代码时，报尾也用于DAC和IAC。

拖车是四个符号的固定零一模式。拖车与同步字的三个MSB一起形成一个7位的交替和零的模式，可用于扩展的直流补偿。取决于同步字的MSB是否分别为0或1，拖尾序列是“1010”或“0101”（以传输顺序）。拖车的选择如图6.7所示。

图6.7：当同步字的MSB为0（a），当同步字的MSB为1（b）时，CAC中的报尾

## 6.4 PACKET HEADER

标题包含链接控制（LC）信息，由6个字段组成：

- LT_ADDR：3位逻辑传输地址
- 类型：4位类型代码
- 流量：1位流量控制
- ARQN：1位确认指示
- SEQN：1位序列号
- HEC：8位头错误检查

包括HEC的总标题由18位组成，见图6.8，并以速率1/3 FEC（未显示，但在7.4节中描述）进行编码，从而产生54位报头。LT_ADDR和TYPE字段首先发送LSB。

图6.8：标题格式


### 6.4.1 LT_ADDR

3位LT_ADDR字段包含数据包的逻辑传输地址（请参见第4.2节）。该字段表示主从传输时隙中的数据包的目标从设备（或广播情况下的从设备），并指示从设备到主站传输时隙的源从设备。

### 6.4.2 TYPE

可以区分16种不同类型的数据包。4位TYPE代码指定使用哪种数据包类型。TYPE代码的解释取决于数据包中的逻辑传输地址。首先，确定是否在SCO逻辑传输，eSCO逻辑传输，ACL逻辑传输或CSB逻辑传输上发送数据包。其次，确定LT_ADDR指示的逻辑传输（ACL或eSCO）是否启用了增强数据速率。然后可以确定已经接收到哪种类型的SCO分组，eSCO分组或ACL分组。TYPE代码确定当前数据包将占用多少个时隙（见表6.2中的插槽占用列）。这允许非寻址接收器在剩余时隙的持续时间内避免收听信道。在第6.5节中，更详细地描述了每个分组类型。

### 6.4.3流

FLOW位用于通过ACL逻辑传输的数据包流控制。当接收方的ACL逻辑传输的RX缓冲区已满时，应返回停止指示（FLOW = 0），以暂停其他设备传输数据。STOP信号仅影响ACL数据包。
仅包含链路控制信息（ID，POLL和NULL数据包），SCO数据包或eSCO数据包的数据包仍可以被接收。当RX缓冲区可以接受数据时，返回GO指示（FLOW = 1）。当没有收到数据包或者接收到的报头出错时，应隐含地假定GO。在这种情况下，从机可以使用CRC接收新的数据包，尽管它的RX缓冲区仍然没有清空。因此，即使数据包通过CRC校验，从器件也应该返回NAK。

在eSCO逻辑运输上不使用FLOW位，在发送时将其设置为1，在收到时忽略。FLOW位保留供CSB逻辑传输的将来使用。

### 6.4.4 ARQN

1位确认指示ARQN用于通过CRC通知源的有效载荷数据的成功传输，并且可以是肯定确认ACK或否定确认NAK。有关该位的初始化和使用，请参见第7.6节。

ARQN位保留供CSB逻辑传输的将来使用。

### 6.4.5 SEQN

SEQN位提供顺序编号方案来排序数据分组流。有关SEQN位的初始化和使用，请参见第7.6.2节。对于主动从设备广播数据包，使用修改的排序方法，请参见第7.6.5节。

SEQN位保留供CSB逻辑传输的将来使用。

### 6.4.6 HEC

每个头都有一个头错误检查来检查头的完整性。HEC是一个8位字（HEC的生成在7.1.1节中指定）。在生成HEC之前，HEC发生器以8位值初始化。对于在主应答子状态中发送的FHS数据包，应使用从设备上地址部分（UAP）。对于在查询响应中发送的FHS分组和扩展查询响应分组，应使用默认检查初始化（DCI，请参见第1.2.1节）。在所有其他情况下，应使用主设备的UAP。

初始化后，应为10个标题位计算HEC。在检查HEC之前，接收机应使用正确的8位UAP（或DCI）来初始化HEC检查电路。如果HEC不检查，整个数据包将被丢弃。更多信息，请参见第7.1节。


## 6.5分组类型

微微网上使用的数据包与使用它们的逻辑传输有关。定义具有不同分组类型的四个逻辑传输（参见第4节）：

- SCO逻辑运输
- eSCO逻辑运输
- ACL逻辑传输
- CSB逻辑运输。

为了指示逻辑传输上的不同数据包，使用4位TYPE代码。分组类型分为四个部分。第一个段被保留用于控制数据包。所有控制包占用单个时隙。第二个段保留用于占用单个时隙的数据包。第三段保留用于占用三个时隙的数据包。第四个段保留用于占用五个时隙的数据包。插槽占用率反映在分段中，可以直接从类型代码中导出。表6.2总结了SCO，eSCO，ACL和CSB逻辑传输类型定义的报文;破折号意味着该值被保留以供将来使用。

具有有效载荷的所有数据包类型应使用GFSK调制，除非在以下各节中另有规定。

ACL逻辑传输使用packet_type_table（ptt）参数通过LMP显式选择增强数据速率数据包类型。当eSCO逻辑传输建立时，选择eSCO增强型数据速率数据包类型。当建立CSB逻辑传输时，选择用于CSB逻辑传输的增强型数据速率分组类型。

### 6.5.1通用数据包类型

有五种常见的数据包。除了前一表的段1中列出的类型之外，ID分组也是公共分组类型，但是由于它不具有分组报头，因此不在分段1中列出。

#### 6.5.1.1 ID包

身份或ID分组由设备接入码（DAC）或查询接入码（IAC）组成。它的固定长度为68位。这是一个非常强大的数据包，因为接收机使用位相关器将接收的数据包与ID数据包的已知位序列相匹配。

#### 6.5.1.2 NULL数据包

NULL分组没有有效载荷，仅由通道接入码和分组报头组成。其总（固定）长度为126位。可以使用NULL分组来返回关于先前传输（ARQN）的成功或RX缓冲器（FLOW）的状态的源的链路信息。NULL数据包不需要确认。

#### 6.5.1.3 POLL数据包

POLL数据包与NULL数据包非常相似。它没有有效载荷。与NULL数据包相反，它需要收件人的确认。它不是ARQ方案的一部分。POLL包不影响ARQN和SEQN字段。在接收到POLL分组时，即使从机没有任何信息发送，从机也应该进行响应，除非从机在该时隙中具有分组互联网承诺。该返回分组是POLL分组的隐式确认。该数据包可以由微控制器中的主机使用来轮询从设备。从设备不发送POLL数据包。POLL数据包不应在CSB（Connectionless Slave Broadcast，无连接从设备广播）逻辑传输上发送。

#### 6.5.1.4 FHS数据包

FHS分组是一个特殊的控制分组，其中包含蓝牙设备地址和发送者的时钟。有效载荷包含144个信息位和16位CRC码。有效载荷用总共有效载荷长度为240位的速率2/3 FEC进行编码。

图6.9说明了FHS有效载荷的格式和内容。FHS数据包用于页面主应答，查询响应和角色切换。

FHS包未加密。没有有效载荷头或MIC。
FHS分组包含实时时钟信息。这个时钟信息应在每个重传之前更新。FHS有效载荷的重发与普通数据有效载荷的重传不同，其中每个重传使用相同的有效载荷。FHS数据包在微网通道建立之前或当现有微微网更改为新的微微网时用于频率跳跃同步。然而，无连接从播广播从设备不使用FHS分组，用于与CSB（Connectionless Slave Broadcast，无连接从设备广播）主机进行跳频同步。


图6.9：FHS有效载荷的格式

每个字段在下面更详细地描述：

奇偶校验位

该34位字段包含形成发送FHS分组的设备的接入码的同步字的第一部分的奇偶校验位。这些位是从LAP导出的，如第1.2节所述。

LAP

此24位字段应包含发送FHS数据包的设备的较低地址部分。

EIR

该位应指示可能遵循扩展的查询响应数据包。见第8.4.3节。

保留的

该1位字段保留供将来使用。

SR

该2位字段是扫描重复字段，并指示两个连续的页面扫描窗口之间的间隔，另见表6.4和表8.1

SP

该2位字段应设置为10b。

UAP

该8位字段应包含发送FHS数据包的设备的上位地址部分。

小憩

该16位字段应包含发送FHS数据包的设备的非重要地址部分（另请参见LAP，UAP和NAP的第1.2节）。

设备类

此24位字段应包含发送FHS数据包的设备的类别。该字段在蓝牙分配号码中定义。

LT_ADDR

如果在连接建立或角色切换时使用FHS数据包，则此3位字段应包含接收方应使用的逻辑传输地址。响应于询问请求消息的主设备或设备响应的从设备应包括全零的LT_ADDR字段，如果发送FHS分组。

CLK27-2

该26位字段应包含发送FHS分组的设备的本地时钟的值，该FHS分组在该FHS分组的接入码的传输开始时进行采样。该时钟值的分辨率为1.25ms（两时隙间隔）。对于每个新的传输，该字段被更新，使其准确地反映实时时钟值。

页面扫描模式

该3位字段应指示FHS数据包的发送方默认使用哪种扫描模式。页面扫描模式的解释如表6.5所示。

表6.3：FHS有效载荷说明


发送FHS的设备应根据表6.4设置SR位。

表6.4：SR域的内容

发送FHS的设备应根据表6.5设置页面扫描模式位。

表6.5：页面扫描模式字段的内容

LAP，UAP和NAP一起形成发送FHS数据包的设备的48位蓝牙设备地址。使用奇偶校验位和LAP，接收者可以直接构建FHS分组的发送方的信道接入码。

初始化HEC和CRC的FHS数据包的查询响应时，UAP为DCI。

#### 6.5.1.5 DM1包

DM1是段1的一部分，以支持允许DM1分组的任何逻辑传输中的控制消息（见表6.2）。但是，它也可以携带常规的用户数据。由于DM1报文可以被认为是一个ACL报文，所以将在6.5.4节进行讨论。

### 6.5.2 SCO数据包

在同步SCO逻辑传输中使用HV和DV数据包。HV数据包不包括MIC或CRC，不得重发。DV数据包在数据部分包括CRC，但不包括在同步数据部分。DV数据包不包括MIC。 DV数据包的数据段应重传。SCO数据包可能被路由到同步I/O端口。
在SCO逻辑传输中允许四个数据包：HV1，HV2，HV3和DV。这些分组通常用于64kb/s语音传输，但可用于透明同步数据。

当启用E0时，SCO数据包只能用E0加密。当启用AES-CCM加密时，SCO数据包不发送。

#### 6.5.2.1 HV1数据包

HV1数据包有10个信息字节。字节以速率1/3 FEC进行保护。不存在MIC不存在CRC。有效载荷长度固定为240位。没有有效载荷头部存在。

#### 6.5.2.2 HV2数据包

HV2包具有20个信息字节。字节以速率2/3 FEC进行保护。不存在MIC不存在CRC。有效载荷长度固定为240位。没有有效载荷头部存在。

#### 6.5.2.3 HV3数据包

HV3数据包有30个信息字节。字节不受FEC保护。不存在MIC不存在CRC。有效载荷长度固定为240位。没有有效载荷头部存在。

#### 6.5.2.4 DV数据包

DV分组是组合数据 - 语音分组。DV数据包只能用于代替HV1数据包。有效载荷被划分为80位的语音字段和包含多达150位的数据字段，如图6.10所示。语音字段不受FEC保护。数据字段具有1到10个信息字节（包括1字节有效负载头）加上16位CRC码。不存在MIC数据字段（包括CRC）以速率2/3 FEC进行编码。由于DV数据包由于其同步内容而必须定期发送，所以在SCO数据包类型下列出。语音和数据字段应分开处理。声场应与正常SCO数据相同的方式进行处理，不得重传;那就是语音领域总是新的。检查数据字段是否有错误，必要时重新发送。当在SCO逻辑传输终止之前DV数据包中的异步数据字段未被确认时，异步数据字段将在DM1数据包中重传。

图6.10：DV数据包格式

### 6.5.3 eSCO包

EV数据包用于同步eSCO逻辑传输。分组包括CRC，并且如果在重传窗口内没有接收到适当接收的确认，则可以应用重传。不存在MIC eSCO数据包可以路由到同步I/O端口。三种eSCO数据包类型（EV3，EV4，EV5）被定义为基本速率操作和四个额外的eSCO数据包类型（2-EV3,3-EV3,2-EV5,3-EV5），用于增强数据速率操作。eSCO数据包可以用于64kb/s的语音传输以及64kb/s和其他速率的透明数据。

#### 6.5.3.1 EV3数据包

EV3数据包具有1到30个信息字节加上16位CRC码。不存在MIC字节不受FEC保护。 EV3数据包可能会覆盖单个时隙。没有有效载荷头部存在。有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

#### 6.5.3.2 EV4数据包

EV4数据包具有1到120个信息字节加上16位CRC码。不存在MICEV4数据包可以覆盖三个时隙。信息加CRC比特用速率2/3 FEC进行编码。没有有效载荷头部存在。有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

#### 6.5.3.3 EV5数据包

EV5包具有1到180个信息字节加上16位CRC码。不存在MIC字节不受FEC保护。 EV5数据包最多可以覆盖三个时隙。没有有效载荷头部存在。有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

#### 6.5.3.4 2-EV3数据包

2-EV3数据包与EV3数据包相似，除了使用有效载荷进行调制/ 4-DQPSK。它有1到60个信息字节加上16位CRC码。不存在MIC字节不受FEC保护。 2-EV3分组覆盖单个时隙。没有有效载荷头部存在。

有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

#### 6.5.3.5 2-EV5包

2-EV5数据包与EV5数据包相似，除了有效载荷被调制使用？/ 4-DQPSK。它有1到360个信息字节加上16位CRC码。不存在MIC字节不受FEC保护。 2-EV5包最多可以包含三个时隙。没有有效载荷头部存在。有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

#### 6.5.3.6 3-EV3包

除了使用8DPSK调制有效载荷之外，3-EV3分组与EV3分组相似。它有1到90个信息字节加上16位CRC码。不存在MIC字节不受FEC保护。 3- EV3数据包涵盖单个时隙。没有有效载荷头部存在。有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

#### 6.5.3.7 3-EV5包

除了使用8DPSK调制有效载荷之外，3-EV5分组与EV5分组相似。它有1到540个信息字节加上16位CRC码。不存在MIC字节不受FEC保护。 3-EV5包最多可以包含三个时隙。没有有效载荷头部存在。有效载荷长度在LMP eSCO设置期间设置，并保持固定，直到链路被移除或重新协商为止。

### 6.5.4 ACL数据包

ACL数据包用于异步逻辑传输和CSB逻辑传输。所携带的信息可以是用于异步逻辑传输的逻辑传输或控制数据的用户数据。

基本速率操作定义了七种数据包类型：DM1，DH1，DM3，DH3，DM5，DH5和AUX1。为增强数据速率操作定义了六个附加数据包：2-DH1,3-DH1,2-DH3,3-DH3,2-DH5和3-DH5。

有效载荷报头中的长度指示符指定用户字节数（不包括有效载荷头，MIC和CRC码）。

#### 6.5.4.1 DM1包

DM1报文仅携带数据信息。有效载荷具有1到18个信息字节（包括1字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。

DM1分组占用单个时隙。信息位，MIC位（当存在时）加上CRC位用速率2/3 FEC进行编码。 DM1数据包中的有效载荷头部长度为1字节，见图6.12。

#### 6.5.4.2 DH1包

该分组类似于DM1分组，除了有效载荷中的信息不被FEC编码。结果，DH1分组具有1到28个信息字节（包括1字节有效负载报头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。DH1分组占用单个时隙。

#### 6.5.4.3 DM3数据包

DM3分组最多可占用三个时隙。有效载荷具有2到123个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。信息位，MIC位（当存在时）加上CRC位用速率2/3 FEC进行编码。 DM3数据包中的有效负载头长度为2字节，见图6.13。

#### 6.5.4.4 DH3包

该分组类似于DM3分组，除了有效载荷中的信息不被FEC编码。结果，DH3分组具有2到185个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。DH3分组最多可占用三个时隙。

#### 6.5.4.5 DM5包

DM5数据包可能占用多达五个时隙。有效载荷具有2到226个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。DM5数据包中的有效载荷头部长度为2个字节。信息位，MIC位（当存在时）加上CRC位用速率2/3 FEC进行编码。

#### 6.5.4.6 DH5包

该分组类似于DM5分组，除了有效载荷中的信息不是FEC编码的。结果，DH5分组具有2到341个信息字节（包括2字节有效载荷报头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。DH5数据包可能占用多达五个时隙。

#### 6.5.4.7 AUX1数据包

该数据包类似于DH1数据包，但没有MIC或CRC码。AUX1分组具有1到30个信息字节（包括1字节有效载荷头）。AUX1分组占用单个时隙。AUX1报文不能用于ACL-U，ACL-C，ASB-C或PBD逻辑链路。AUX1分组可能被丢弃。仅当启用E0加密时，AUX1数据包才被加密。当启用AES-CCM加密时，AUX1数据包不被使用。

#### 6.5.4.8 2-DH1包

该数据包类似于DH1数据包，除了有效负载是使用？/ 4-DQPSK。 2-DH1分组具有2到56个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。2-DH1分组占用单个时隙。

#### 6.5.4.9 2-DH3包

该数据包类似于DH3数据包，除了有效负载是使用？/ 4-DQPSK。 2-DH3分组具有2到369个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。2-DH3包最多可能占用3个时隙。

#### 6.5.4.10 2-DH5包

该数据包类似于DH5数据包，除了有效负载是使用？/ 4-DQPSK。 2-DH5分组具有2到681个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。2-DH5数据包最多可能占用5个时隙。

#### 6.5.4.11 3-DH1包

该分组类似于DH1分组，除了使用8DPSK调制有效载荷。 3-DH1分组具有2到85个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。3-DH1分组占用单个时隙。

#### 6.5.4.12 3-DH3包

该分组类似于DH3分组，除了使用8DPSK调制有效载荷。 3-DH3分组具有2到554个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。3-DH3包最多可能占用3个时隙。

#### 6.5.4.13 3-DH5包

该分组类似于DH5分组，除了使用8DPSK调制有效负载。 3-DH5分组具有2到1023个信息字节（包括2字节有效载荷头）加上16位CRC码。仅当使用AES-CCM进行加密时，才能存在32位MIC。3-DH5数据包最多可能占用5个时隙。

## 6.6 PAYLOAD FORMAT

在有效载荷中，区分两个字段：同步数据字段和异步数据字段。ACL数据包只有异步数据字段，而SCO和eSCO数据包只有同步数据字段？除了具有两者的DV分组之外。

### 6.6.1同步数据字段

在SCO中，仅支持基本速率模式，同步数据字段具有固定长度，仅由同步数据体部分组成。没有有效载荷头部存在。

在基本速率eSCO中，同步数据字段由两个段组成：同步数据体和CRC码。没有有效载荷头部存在。

在增强数据速率eSCO中，同步数据字段由保护周期，同步序列，同步数据体，CRC码和报尾等五个部分组成。没有有效载荷头部存在。

1。增强的数据速率保护周期

对于增强型数据速率分组，保护周期被定义为从头部的最后一个GFSK符号结束开始并在同步序列的参考符号的起始处结束的周期。保护周期的长度应在4.75μs到5.25μs之间。

2。增强数据速率同步序列

对于增强数据速率分组，同步序列开始时的符号定时应在分组报头的最后GFSK符号的符号定时的±1/4μs内。同步序列的长度为11μs（11个DPSK符号），由参考符号（任意相位）和10个DPSK符号组成。

DPSK符号之间的相位变化（如定义：同步序列所示）应为

（EQ 13）

图6.11：同步序列

Sref是参考符号。 ？1是参考符号和第一DPSK符号S1之间的相位变化。 ？k是第k-1个符号Sk-1和第k个符号Sk之间的相位变化

注意：可以使用调制器通过预先生成同步序列的位的数据来生成同步序列。

对于pi/4-DQPSK，用于产生同步序列的比特序列为0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1,0 ，1,0,1。

对于8DPSK，用于产生同步序列的比特序列为0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,1,1,1,1 ，1,1,0,1,0,0,1,0,0,1,0。

3。同步数据体

对于HV和DV数据包，同步数据体长度是固定的。对于EV数据包，在LMP eSCO设置期间协商同步数据体长度。一旦协商，同步数据主体长度保持不变，除非重新协商。对于eSCO逻辑传输的每个方向，同步数据体长度可能不同。

4。CRC码

有效载荷中的16位CRC按7.1节的规定生成。主机的8位UAP用于初始化CRC发生器。

仅使用同步数据主体段来生成CRC代码。

5。增强数据速率报尾

对于增强型数据速率数据包，两个尾部符号应添加到有效载荷的末尾。拖尾位全部为零，即{00，00}为？/ 4 DQPSK和{000，000}用于8DPSK。

### 6.6.2异步数据字段

基本速率ACL分组具有由两个，三个或四个分段组成的异步数据字段：有效负载报头，有效载荷主体，可能的MIC以及可能的CRC代码。

增强型数据速率ACL分组具有包括六个或七个分段的异步数据字段：保护周期，同步序列，有效负载报头，有效载荷主体，可能的MIC，CRC和报尾。

1。增强数据速率保护周期
这与第6.6.1节中的同步数据字段的定义相同。
2。增强数据速率同步序列
这与第6.6.1节中的同步数据字段的定义相同。
3。有效载荷标题
有效载荷头是一个或两个字节长。第一和第二段的基本速率数据包具有1字节的有效载荷头;第三和第四段的基本速率分组和所有增强型数据速率分组都有一个2字节的有效负载报头。有效负载头指定逻辑链路（2位LLID指示），控制逻辑信道上的流（1位FLOW指示），并具有有效负载长度指示符（1位和2字节为5位和10位有效负载标头）。在2字节有效载荷头部的情况下，长度指示符被扩展到下一个字节5位。第二个字节的剩余三位保留供将来使用。1字节和2字节有效负载头的格式如图6.12和图6.13所示。

图6.12：基本速率单时隙ACL数据包的有效负载头格式

图6.13：多时隙ACL报文和所有EDR ACL报文的有效载荷报头格式

首先发送LLID字段，最后发送长度字段。在表6.6中列出了有关LLID字段内容的更多细节。

表6.6：逻辑链路LLID字段内容

L2CAP消息可以被分段成几个分组。代码10b应用于承载该消息的第一个片段的ACL-U或ASB-U数据包;代码01b应用于连续片段。通过HCI发送的L2CAP消息的第一片段通过具有映射到LLID代码10b的Packet_Boundary_Flag值00b或10b来识别。如果没有碎片，则每个数据包都使用代码10b。通过PBD逻辑链路使用的ACL报文不使用分片。对于通过PBD逻辑链路使用的ACL数据包，发送器应使用LLID代码10b。通过不等于10b的LLID的PBD逻辑链路使用的任何ACL报文将被接收机忽略。代码11b应用于LMP消息。代码00b保留供将来使用。

有效载荷中的流量指示器用于控制L2CAP级别的流量。它用于控制每个逻辑链路的流量。FLOW = 1表示流通（GO），FLOW = 0表示流出（STOP）。建立新的连接后，流量指示器应设置为GO。当设备接收到流量位设置为STOP的有效负载报头时，在发送额外的有效载荷数据量之前，它将停止传输ACL-U数据包。该量被定义为流量控制滞后，以字节数表示。流量控制滞后越短，其他设备必须减少对此功能的缓冲。流量控制滞后不得超过1792字节（7？256字节）。为了允许设备优化分组长度和缓冲区空间的选择，在LMP_features_res消息中应提供给定实现的流控制滞后。

如果接收到包含有效载荷流量位为STOP的数据包，则使用有效的数据包头，但是有效负载，则有效负载流控制位将被忽略。将包含在包头中的基带ACK将被接收，并且可以发送另外的ACL分组。这种情况的每次出现允许进一步的ACL分组被发送，尽管流量控制请求是经由有效载荷头部流控制位发送的。建议使用有效载荷头流程位的设备应确保在有效负载流位被正确接收之前不再发送进一步的ACL数据包。这可以通过同时打开分组报头中的流位并保持其直到ACK被接收（ARQN = 1）来实现。这通常只有一个往返时间。由于它们缺乏有效载荷CRC，因此AUX1数据包不应与有效负载流程的STOP位一起使用。

基带资源管理器负责设置和处理有效负载报头中的流位。实时流量控制应由链路控制器通过数据包头中的流位执行（见6.4.3节）。利用有效载荷流位，可以控制来自远端的流量。允许生成并发送有效载荷长度为零的ACL数据包，无论流量状态如何。当有效载荷长度等于零时，L2CAP起始片段和继续片段指示（LLID = 10和LLID = 01）也保留其含义（即，一个空的起始片段不会在正在进行的ACL的中间发送-U或ASB-U分组传输）。发送长度为0和LLID = 01的ACL数据包始终是安全的。有效载荷流位对于每个逻辑链路都有其自己的含义，见表6.7。在ACL-C，ASB-C和ASB-U逻辑链路上，不应用流量控制，并且总是将有效载荷FLOW位设置为1。在PBD逻辑链路上，不应用流量控制，并且总是将有效载荷FLOW位设置为零。


表6.7：在逻辑链路上使用有效载荷头流程位

长度指示符应设置为有效负载中不包括有效载荷头，MIC和CRC码的字节数（即8位字）;即仅有效载荷体。参考图6.12和图6.13，1字节报头中的长度字段的MSB是有效载荷报头中的最后一个（最右）位; 2字节报头中的长度字段的MSB是有效载荷报头中第二个字节最右端的第四位。

4。有效载荷体

有效载荷主体包括用户信息并确定有效的用户吞吐量。有效载荷主体的长度在有效载荷报头的长度字段中指示。

5。消息完整性检查

有效载荷中的32位消息完整性检查（MIC）按照[Vol 2] H部分9.2节的规定生成。

6。CRC代码生成

有效载荷中的16位循环冗余校验码按7.1节的规定生成。在确定CRC码之前，使用8位值来初始化CRC发生器。对于在主应答子状态中发送的FHS数据包中的CRC码，使用从机的UAP。对于在查询响应子状态中发送的FHS分组和扩展查询响应分组，使用DCI（参见第1.2.1节）。对于所有其他数据包，使用主机的UAP。

仅使用有效载荷头，有效载荷体和MIC段（如果存在）用于生成CRC码。

7。增强数据速率报尾

这与第6.6.1节中的同步数据字段的定义相同。

## 6.7分组概要

数据包的总结及其特性如表6.8，表中所示
## 6.9和表6.10。有效载荷表示除FEC，CRC和有效载荷头之外的分组有效载荷。

表6.8：链路控制报文

表6.9：ACL报文

表6.10：同步数据包

1。后跟“D”的项目仅与数据字段相关。