# 蓝牙5规范第1卷A部分第6章蓝牙应用架构

标签（空格分隔）： Bluetooth

---

# 6 蓝牙应用架构

## 6.1 蓝牙配置文件

蓝牙系统中的应用互操作性由蓝牙配置文件完成。 蓝牙配置文件定义了蓝牙系统中每层从PHY到L2CAP以及Core规范之外的任何其他协议所需的功能和特性。 配置文件定义了层之间的垂直交互以及设备之间特定层的对等交互。

![图6.1：蓝牙配置文件](http://upload-images.jianshu.io/upload_images/3764796-409224a5e62b8f6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

此外，应用程序行为和数据格式也由配置文件定义。 当两个设备符合蓝牙配置文件的所有要求时，启用应用程序的互操作性。

所有配置文件描述了设备连接所需的服务发现要求，查找应用程序级连接所需的可用应用程序服务和连接信息。

## 6.2 一般访问简档

蓝牙系统定义了所有蓝牙设备实现的基本配置文件。 该配置文件是通用访问配置文件（GAP），其定义了蓝牙设备的基本要求。 例如，对于BR / EDR，它定义了一个蓝牙设备，以包括无线电，基带，链路管理器，L2CAP和服务发现协议功能; 对于LE，它定义了物理层，链路层，L2CAP，安全管理器，属性协议和通用属性配置文件。 这将所有各层结合在一起，以形成蓝牙设备的基本要求。 它还描述了设备发现，连接建立，安全性，认证，关联模型和服务发现的行为和方法。

在BR / EDR中，GAP定义了单个角色，其功能可能存在于每个设备中。 此功能包括设备如何相互发现，建立连接并描述用于认证的安全关联模型。 在BR / EDR中，这两个设备可能存在此功能。 如果设备想要发现或建立与所有设备的连接，设备可能需要同时实现启动和接受功能。 设备可以仅包括发起或接受功能，但是它需要远程设备来支持发现或建立与设备的连接的互补功能。 对于BR / EDR，控制器需要支持所有功能，但主机可能会根据设备支持的其他配置文件或用例来限制此功能。

在LE中，GAP定义了四个具体角色：广播，观察者，周边和中央。 如果底层控制器支持这些角色或角色组合，则设备可以支持多个LE GAP角色。 每个角色指定底层Controller的要求。 这允许控制器针对特定用例进行优化。

**Broadcaster**角色针对发射机应用进行了优化。 支持广播角色的设备使用广告来广播数据。 广播机构角色不支持连接。 **Observer**角色针对接收机应用进行了优化。 支持观察者角色的设备是广播机构的补充设备，并接收广告中包含的广播数据。 观察者角色不支持连接。 **外设**角色针对支持单一连接的设备进行了优化，并且不如中央设备复杂。 支持外设角色的设备只需要支持控制器从站角色的控制器。 **中央**角色支持多个连接，并且是与外设角色中的设备的所有连接的启动器。 支持中心角色的设备需要一个支持控制器主控角色的控制器，与其他LE GAP角色相比，通常支持更复杂的功能。

## 6.3 简介分级

由于所有蓝牙设备都需要实施GAP，所以蓝牙设备实现的任何附加配置将成为GAP的超集。 根据应用程序的复杂性或许多应用程序重用蓝牙系统功能的常见要求的能力，可以创建额外的通用配置文件，这两个配置文件既是GAP的超集，也是另一个配置文件的超集。 描述应用程序互操作性的顶级配置文件称为应用程序配置文件。

![图6.2：配置文件层次结构](http://upload-images.jianshu.io/upload_images/3764796-92dff8d5a14c8565.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

应用程序配置文件包含参考GAP和描述蓝牙系统的一组常见要求的任何其他通用配置文件。

## 6.4 一般属性简介

通用属性配置文件（GATT）建立在属性协议（ATT）之上，并为属性协议传输和存储的数据建立常用操作和框架。 GATT定义了两个角色：服务器和客户端。 GATT角色不一定与特定的GAP角色相关，但可能由较高层配置文件指定。 GATT和ATT不具体运输，可用于BR / EDR和LE。 然而，GATT和ATT是强制性的，因为它用于发现服务

GATT服务器存储通过属性协议传输的数据，并接受GATT客户端的属性协议请求，命令和确认。 GATT服务器向请求发送响应，配置时，在GATT服务器上发生指定事件时，将异步发送指示和通知给GATT客户端。

GATT还规定了GATT服务器上包含的数据格式。 由属性协议传输的属性被格式化为**服务**和**特性** 。 服务可能包含一系列特征。 特征包含单个值和描述特征值的任意数量的描述符。

通过定义的服务结构，不属于配置文件的GATT客户端的特征和特征描述符仍然可以遍历GATT服务器并向用户显示特征值。 特征描述符可用于显示可能使该值可被用户理解的特征值的描述。

## 6.5 基于GATT的配置文件

GATT配置文件指定配置文件数据交换的结构。 该结构定义了在配置文件中使用的基本元素，如服务和特征。

层次结构的顶层是一个配置文件。 配置文件由满足用例所需的一个或多个服务组成。 服务由特征或其他服务的引用组成。 每个特征包含一个值，并且可以包含有关该值的可选信息。 特征的特征和特征（即值和描述符）包含配置文件数据，并且都存储在服务器上的属性中。

![图6.3：基于GATT的配置文件层次结构](http://upload-images.jianshu.io/upload_images/3764796-46f034c7b9e58bba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 6.5.1 服务

服务是数据和相关行为的集合，以实现设备或设备的一部分的特定功能或特征。 服务可以引用构成该服务的其他主要或次要服务和/或一组特征。

有两种类型的服务：主要和次要的。 主要服务是提供设备主要功能的服务。 辅助服务是提供设备的辅助功能并从设备上的至少一个主要服务引用的服务。

为了保持与早期客户端的向后兼容性，服务定义的后续版本只能添加新的引用服务或可选特性。 服务定义的后期修订也不能从以前修订的服务定义中改变行为。

可以在一个或多个配置文件中使用服务来实现特定的用例。

### 6.5.2 参考服务

引用的服务是将服务器上的其他服务定义合并为引用它的服务的一部分的方法。 当服务引用另一个服务时，整个引用的服务将成为新服务的一部分，包括任何嵌套的引用服务和特征。 引用的服务仍然是独立服务。 嵌套引用的深度没有限制。

### 6.5.3 特性

特征是服务中使用的值以及有关如何访问值的属性和配置信息以及有关如何显示或表示值的信息。 特征定义包含特征声明，特征属性和值。 它还可以包含描述服务器相对于特征值的值或允许配置的描述符。




